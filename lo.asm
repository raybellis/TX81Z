;****************************************************
;* A09 Assembler options			    *
;****************************************************

	IF	&VERSION < $012C
		ERR	"Incompatible assembler version - 1.44 or higher required"
	ENDIF

			OPT	H03,NCL,NOW,EXP

FILCHR			TEXT	$FF
BANK			TEXT	LO

			INCLUDE	"inc/hw.asm"
			INCLUDE	"inc/ram.asm"
			INCLUDE	"inc/constants.asm"
			INCLUDE	"inc/macros.asm"

;****************************************************
;* Used Labels					    *
;****************************************************

; CPU RAM

M0051			EQU	$0051
M0052			EQU	$0052
M0056			EQU	$0056
M0058			EQU	$0058
M005A			EQU	$005A
M0077			EQU	$0077
M0079			EQU	$0079
M007B			EQU	$007B
M009A			EQU	$009A
M009F			EQU	$009F
M00A3			EQU	$00A3
M00A5			EQU	$00A5
M00A6			EQU	$00A6
M00A7			EQU	$00A7
M00A9			EQU	$00A9
M00AB			EQU	$00AB
M00AC			EQU	$00AC
M00C7			EQU	$00C7
M00CC			EQU	$00CC
M00CD			EQU	$00CD
M00CE			EQU	$00CE
M00CF			EQU	$00CF
M00D0			EQU	$00D0
M00D1			EQU	$00D1
M00D2			EQU	$00D2
M00D3			EQU	$00D3
M00D4			EQU	$00D4
M00D5			EQU	$00D5
M00D6			EQU	$00D6
M00D7			EQU	$00D7
M00D8			EQU	$00D8
M00D9			EQU	$00D9
M00DA			EQU	$00DA
M00DC			EQU	$00DC
M00DE			EQU	$00DE
M00F1			EQU	$00F1

; System RAM

M69C1			EQU	$69C1
M6A04			EQU	$6A04
M6A0A			EQU	$6A0A
M6A0B			EQU	$6A0B
M6A0D			EQU	$6A0D
M6A0E			EQU	$6A0E
M6A0F			EQU	$6A0F
M6A11			EQU	$6A11
M6A15			EQU	$6A15
M6A16			EQU	$6A16
M6A17			EQU	$6A17
M6A19			EQU	$6A19
M6A67			EQU	$6A67
M6AA5			EQU	$6AA5
M6AA6			EQU	$6AA6
M6AC0			EQU	$6AC0
M6DD7			EQU	$6DD7
M6E07			EQU	$6E07
M6E37			EQU	$6E37
M6E3A			EQU	$6E3A
M6E3B			EQU	$6E3B
M7565			EQU	$7565
M7566			EQU	$7566
M7567			EQU	$7567
M7568			EQU	$7568
M7569			EQU	$7569
M756A			EQU	$756A
M756B			EQU	$756B
M756C			EQU	$756C
M756D			EQU	$756D
M756E			EQU	$756E
M756F			EQU	$756F
M7571			EQU	$7571
M75F1			EQU	$75F1
M75F8			EQU	$75F8
M7628			EQU	$7628
M7640			EQU	$7640
M7740			EQU	$7740
M7750			EQU	$7750
M776D			EQU	$776D
M776E			EQU	$776E
M7770			EQU	$7770
M7772			EQU	$7772
M7773			EQU	$7773
M7774			EQU	$7774
M7779			EQU	$7779
M777A			EQU	$777A
M777B			EQU	$777B
M777C			EQU	$777C
M777E			EQU	$777E
M777F			EQU	$777F
M7781			EQU	$7781
M7784			EQU	$7784
M7787			EQU	$7787
M7788			EQU	$7788
M7789			EQU	$7789
M778A			EQU	$778A
M778B			EQU	$778B
M778C			EQU	$778C
M778D			EQU	$778D
M778F			EQU	$778F
M7791			EQU	$7791
M7792			EQU	$7792
M7793			EQU	$7793
M7794			EQU	$7794
M7795			EQU	$7795
M784E			EQU	$784E
M784F			EQU	$784F
M7933			EQU	$7933
M7D53			EQU	$7D53
M7D63			EQU	$7D63
M7D6B			EQU	$7D6B

M7EE8			EQU	$7EE8
M7F99			EQU	$7F99
M7FE0			EQU	$7FE0

;****************************************************
;* Program Code / Data Areas			    *
;****************************************************

			ORG	$8000

hdlr_RST		BANK_HI				; attempt to select HI bank
			LDAA	#%11111000		; set P63 - P67 as outputs
			STAA	DDR6			; -
			BANK_HI				; attempt to select HI bank (again)
			NOP
			NOP
			RTS

hdlr_OCI		NOP
			BANK_HI				; select HI bank
			NOP
			NOP
			NOP
			NOP
			NOP
			NOP
			RTI

hdlr_CMI		NOP
			BANK_HI				; select HI bank
			NOP
			NOP
			NOP
			NOP
			NOP
			NOP
			RTI

hdlr_SIO		NOP
			BANK_HI				; select HI bank
			NOP
			NOP
			NOP
			NOP
			NOP
			NOP
			RTI

hdlr_IRQ1		NOP
			BANK_HI				; select HI bank
			NOP
			NOP
			NOP
			NOP
			NOP
			NOP
			RTI

			INCLUDE	"inc/xrom.asm"
			INCLUDE	"inc/init.asm"

			ORG	$8200

XROM_VEC2
M8200			FDB	hdlr_RST

; XROM jump table

XROM_VEC		FDB	LO_CALL_00
			FDB	LO_CALL_01
			FDB	LO_CALL_02
			FDB	LO_CALL_03
			FDB	LO_CALL_04
			FDB	LO_CALL_05
			FDB	LO_CALL_06
			FDB	LO_CALL_08
			FDB	LO_CALL_09
			FDB	LO_CALL_0A
			FDB	LO_CALL_0B
			FDB	LO_CALL_0C
			FDB	LO_CALL_0D

;-------

LO_CALL_00		LDAB	#$04
1			PSHB
			LDAB	#$06
			JSR	MEMCPY_xB_A9_A7
			LDX	M00A9
			LDAA	,X
			STAA	M009F
			LDAB	$03,X
			INX
			STX	M00A9
			LDX	M00A7
			PSHB
			ANDB	#$07
			STAB	$06,X
			PULB
			ANDB	#$18
			LSRB
			LSRB
			LSRB
			STAB	,X
			ANDA	#$07
			STAA	$03,X
			LDAA	M009F
			ANDA	#$38
			LSRA
			LSRA
			LSRA
			STAA	$01,X
			LDAA	M009F
			ROLA
			ROLA
			ROLA
			ANDA	#$01
			STAA	$02,X
			LDAB	#$04
			ABX
			LDAB	#$02
			JSR	MEMCPY_xB_A9_X
			LDX	M00A9
			INX
			STX	M00A9
			LDX	M00A7
			INX
			STX	M00A7
			PULB
			DECB
			BNE	1B
			STX	M00A7
			LDX	M00A9
			LDAA	,X
			INX
			STX	M00A9
			LDX	M00A7
			PSHA
			ANDA	#$07
			STAA	,X
			INX
			PULA
			LSRA
			LSRA
			LSRA
			PSHA
			ANDA	#$07
			STAA	,X
			PULA
			ANDA	#$08
			LSRA
			LSRA
			LSRA
			STAA	$05,X
			INX
			LDAB	#$04
			JSR	MEMCPY_xB_A9_X
			LDX	M00A9
			LDAA	,X
			INX
			STX	M00A9
			LDX	M00A7
			INX
			PSHA
			ANDA	#$03
			STAA	,X
			PULA
			LSRA
			LSRA
			PSHA
			ANDA	#$03
			STAA	$02,X
			PULA
			LSRA
			LSRA
			STAA	$01,X
			INX
			INX
			INX
			LDAB	#$01
			JSR	MEMCPY_xB_A9_X
			TST	M756E
			BNE	2F
			LDAB	#$0E
			ABX
			STX	M00A7
			LDX	M00A9
			LDAB	#$0A
			ABX
			STX	M00A9
			JMP	3F
2			LDX	M00A9
			LDAA	,X
			INX
			STX	M00A9
			LDX	M00A7
			STAA	$01,X
			LDX	M00A9
			LDAA	,X
			INX
			STX	M00A9
			LDX	M00A7
			PSHA
			ANDA	#$01
			STAA	$02,X
			PULA
			LSRA
			PSHA
			ANDA	#$01
			STAA	$06,X
			PULA
			LSRA
			PSHA
			ANDA	#$01
			STAA	$05,X
			PULA
			LSRA
			PSHA
			ANDA	#$01
			STAA	,X
			PULA
			LSRA
			ANDA	#$01
			STAA	$07,X
			INX
			INX
			INX
			LDAB	#$02
			JSR	MEMCPY_xB_A9_X
			INX
			INX
			INX
			STX	M00A7
			LDAB	#$06
			JSR	MEMCPY_xB_A9_A7
3			LDAB	#$0A
			JSR	MEMCPY_xB_A9_A7
			LDAB	#$04
4			PSHB
			LDX	M00A9
			LDAA	,X
			INX
			STX	M00A9
			LDX	M00A7
			PSHA
			ANDA	#$07
			STAA	$01,X
			PULA
			LSRA
			LSRA
			LSRA
			PSHA
			ANDA	#$01
			STAA	,X
			PULA
			LSRA
			ANDA	#$03
			STAA	$04,X
			INX
			INX
			STX	M00A7
			LDX	M00A9
			LDAA	,X
			INX
			STX	M00A9
			LDX	M00A7
			PSHA
			ANDA	#$0F
			STAA	,X
			PULA
			LSRA
			LSRA
			LSRA
			LSRA
			ANDA	#$07
			STAA	$01,X
			INX
			INX
			INX
			STX	M00A7
			PULB
			DECB
			BNE	4B
			TST	M756E
			BNE	5F
			LDX	M00A7
			LDAB	#$03
			ABX
			STX	M00A7
			LDX	M00A9
			ABX
			STX	M00A9
			LDAA	M7772
			ANDA	#$04
			BNE	6F
			LDAA	#$01
			STAA	M7792
			BRA	6F
5			LDAB	#$03
			JSR	MEMCPY_xB_A9_A7
6			RTS

;-------

LO_CALL_06		LDAB	#$04
1			PSHB
			LDAB	#$06
			JSR	MEMCPY_xB_A9_A7
			LDX	M00A9
			LDAA	,X
			ASLA
			ASLA
			ASLA
			ADDA	$06,X
			INX
			STX	M00A9
			LDX	M00A7
			STAA	$03,X
			LDX	M00A9
			LDAA	$01,X
			ASLA
			ASLA
			ASLA
			ADDA	,X
			ASLA
			ASLA
			ASLA
			ADDA	$02,X
			INX
			INX
			INX
			STX	M00A9
			LDX	M00A7
			STAA	,X
			INX
			LDAB	#$02
			JSR	MEMCPY_xB_A9_X
			LDX	M00A9
			INX
			STX	M00A9
			LDX	M00A7
			INX
			STX	M00A7
			PULB
			DECB
			BNE	1B
			STX	M00A7
			LDX	M00A9
			LDAA	$06,X
			ASLA
			ASLA
			ASLA
			ADDA	$01,X
			ASLA
			ASLA
			ASLA
			ADDA	,X
			INX
			INX
			STX	M00A9
			LDX	M00A7
			STAA	,X
			INX
			LDAB	#$04
			JSR	MEMCPY_xB_A9_X
			LDX	M00A9
			INX
			LDAA	$01,X
			ASLA
			ASLA
			ADDA	$02,X
			ASLA
			ASLA
			ADDA	,X
			INX
			INX
			INX
			STX	M00A9
			LDX	M00A7
			STAA	,X
			INX
			LDAB	#$01
			JSR	MEMCPY_xB_A9_X
			LDX	M00A9
			LDAA	$01,X
			LDX	M00A7
			STAA	,X
			INX
			STX	M00A7
			LDX	M00A9
			LDAA	$07,X
			ASLA
			ADDA	,X
			ASLA
			ADDA	$05,X
			ASLA
			ADDA	$06,X
			ASLA
			ADDA	$02,X
			INX
			INX
			INX
			STX	M00A9
			LDX	M00A7
			STAA	,X
			INX
			LDAB	#$02
			JSR	MEMCPY_xB_A9_X
			LDX	M00A9
			INX
			INX
			INX
			STX	M00A9
			LDAB	#$10
			JSR	MEMCPY_xB_A9_A7
			LDAB	#$04
2			PSHB
			LDX	M00A9
			LDAA	$04,X
			ASLA
			ADDA	,X
			ASLA
			ASLA
			ASLA
			ADDA	$01,X
			INX
			INX
			STX	M00A9
			LDX	M00A7
			STAA	,X
			INX
			STX	M00A7
			LDX	M00A9
			LDAA	$01,X
			ASLA
			ASLA
			ASLA
			ASLA
			ADDA	,X
			INX
			INX
			INX
			STX	M00A9
			LDX	M00A7
			STAA	,X
			INX
			STX	M00A7
			PULB
			DECB
			BNE	2B
			LDAB	#$03
			JSR	MEMCPY_xB_A9_A7
			RTS

;-------

LO_CALL_05		LDAB	#$08
1			PSHB
			LDX	M00A9
			LDAA	,X
			LDAB	$01,X
			ANDB	#$7F
			INX
			INX
			STX	M00A9
			LDX	M00A7
			PSHA
			ANDA	#$0F
			STAA	,X
			PULA
			LSRA
			LSRA
			LSRA
			LSRA
			PSHA
			ANDA	#$01
			BEQ	2F
			ORAB	#$80
2			STAB	$02,X
			PULA
			LSRA
			ANDA	#$03
			STAA	$09,X
			INX
			INX
			INX
			STX	M00A7
			LDX	M00A9
			LDAA	,X
			INX
			STX	M00A9
			LDX	M00A7
			PSHA
			ANDA	#$1F
			STAA	,X
			PULA
			LSRA
			LSRA
			LSRA
			LSRA
			LSRA
			ANDA	#$03
			STAA	$07,X
			INX
			LDAB	#$03
			JSR	MEMCPY_xB_A9_X
			LDX	M00A9
			LDAA	,X
			INX
			STX	M00A9
			LDX	M00A7
			PSHA
			ANDA	#$3F
			STAA	,X
			PULA
			LSRA
			LSRA
			LSRA
			LSRA
			LSRA
			LSRA
			ANDA	#$01
			STAA	$04,X
			INX
			LDAB	#$01
			JSR	MEMCPY_xB_A9_X
			INX
			INX
			INX
			STX	M00A7
			PULB
			DECB
			BNE	1B
			LDAB	#$01
			JSR	MEMCPY_xB_A9_A7
			LDX	M00A9
			LDAA	,X
			INX
			STX	M00A9
			LDX	M00A7
			PSHA
			ANDA	#$01
			STAA	,X
			PULA
			LSRA
			PSHA
			ANDA	#$03
			STAA	$01,X
			PULA
			LSRA
			LSRA
			ANDA	#$0F
			STAA	$02,X
			INX
			INX
			INX
			LDAB	#$0A
			JMP	MEMCPY_xB_A9_X

;-------

LO_CALL_08		LDAB	#$08
1			PSHB
			LDX	M00A9
			LDAA	$09,X
			ASLA
			TIM	#$80,$02,X
			BEQ	2F
			ADDA	#$01
2			ASLA
			ASLA
			ASLA
			ASLA
			ADDA	,X
			INX
			INX
			STX	M00A9
			LDX	M00A7
			STAA	,X
			INX
			STX	M00A7
			LDX	M00A9
			LDAA	,X
			ANDA	#$7F
			INX
			STX	M00A9
			LDX	M00A7
			STAA	,X
			INX
			STX	M00A7
			LDX	M00A9
			LDAA	$07,X
			ASLA
			ASLA
			ASLA
			ASLA
			ASLA
			ADDA	,X
			INX
			STX	M00A9
			LDX	M00A7
			STAA	,X
			INX
			LDAB	#$03
			JSR	MEMCPY_xB_A9_X
			LDX	M00A9
			LDAA	$04,X
			ASLA
			ASLA
			ASLA
			ASLA
			ASLA
			ASLA
			ADDA	,X
			INX
			STX	M00A9
			LDX	M00A7
			STAA	,X
			INX
			LDAB	#$01
			JSR	MEMCPY_xB_A9_X
			LDX	M00A9
			INX
			INX
			INX
			STX	M00A9
			PULB
			DECB
			BNE	1B
			LDAB	#$01
			JSR	MEMCPY_xB_A9_A7
			LDX	M00A9
			LDAA	$02,X
			ASLA
			ASLA
			ADDA	$01,X
			ASLA
			ADDA	,X
			INX
			INX
			INX
			STX	M00A9
			LDX	M00A7
			STAA	,X
			INX
			LDAB	#$0A
			JMP	MEMCPY_xB_A9_X

;-------

LO_CALL_09		CLR	>M009F
1			JSR	LO_CALL_0D
			LDAB	M009F
			INCB
			STAB	M009F
			CMPB	#$08
			BNE	1B

;-------		fallthrough

LO_CALL_0B		LDX	#M6DD7
			LDAB	#$08
			STX	M00A9
1			LDX	#D_871F
			STX	M00A7
			PSHB
			LDAB	#$0C
			BSR	CLAMP_xB_A9_to_A7
			PULB
			DECB
			BNE	1B
			LDAB	#$04
			BSR	CLAMP_xB_A9_to_A7
			JSR	LO_CALL_0A
			LDX	#M6DD7
			CLRA
			LDAB	#$0C
2			ADDA	,X
			CMPA	#$09
			BCS	3F
			CLR	,X
3			ABX
			CPX	#M6E37
			BNE	2B
			RTS

;-------

LO_CALL_0A		LDAB	#$0A
1			LDAA	#$7F
			LDX	M00A9
			CMPA	,X
			BCC	2F
			STAA	,X
2			LDAA	#$1F
			CMPA	,X
			BCS	3F
			LDAA	#$24
			STAA	,X
3			INX
			STX	M00A9
			DECB
			BNE	1B
			RTS

;-------

D_85F1			FCB	$1F,$1F,$1F,$0F,$0F,$63,$03,$07
			FCB	$01,$07,$63,$3F,$06,$07,$07,$63
			FCB	$63,$63,$63,$01,$03,$07,$03,$30
			FCB	$01,$0C,$01,$63,$63,$01,$01,$01
			FCB	$63,$63,$63,$63,$64,$63

D_8716			FCB	$01,$07,$0F,$07,$03,$07,$63,$63

D_871F			FCB	$08,$00,$9F,$10,$7F,$7F,$0E,$30
			FCB	$63,$03,$03,$01,$0C,$01,$03,$0B

;-------
;
; Clamp the array @(0xA9) to the values in array @(0xA7)
;

CLAMP_xB_A9_to_A7
0			LDX	M00A7		; p = 0x00a7;
			LDAA	,X		; a = *p++;
			INX
			STX	M00A7
			LDX	M00A9		; p = 0x00a9;
			CMPA	,X		; if (*p > a)
			BCC	1F
			STAA	,X		; 	*p = a
1			INX			; ++p
			STX	M00A9
			DECB			; --b
			BNE	0B
			RTS

;-------

LO_CALL_0D		LDAB	M009F
			LDAA	#$6E
			MUL
			ADDD	#M6A67
			STD	M00A9
			CLRB
1			LDX	#D_85F1
			STX	M00A7
			PSHB
			LDAB	#$03
			JSR	CLAMP_xB_A9_to_A7
			TST	,X
			BNE	2F
			LDAA	#$01
			STAA	,X
2			LDAB	#$08
			JSR	CLAMP_xB_A9_to_A7
			TIM	#$3C,$00,X
			BNE	4F
			LDAA	#$6E
			LDAB	M009F
			MUL
			ADDD	#M6AC0
			XGDX
			PULB
			PSHB
			LDAA	#$05
			MUL
			ABX
			LDAA	,X
			CMPA	#$08
			BCS	3F
			LDAA	#$07
3			STAA	,X
4			LDAB	#$02
			JSR	CLAMP_xB_A9_to_A7
			PULB
			INCB
			CMPB	#$04
			BNE	1B
			LDAB	#$19
			JSR	CLAMP_xB_A9_to_A7
			JSR	LO_CALL_0A
			LDAB	#$04
5			LDX	#D_8716
			STX	M00A7
			PSHB
			LDAB	#$05
			JSR	CLAMP_xB_A9_to_A7
			PULB
			DECB
			BNE	5B
			LDX	M00A9
			DEX
			CLR	,X
			LDAB	#$03
			JSR	CLAMP_xB_A9_to_A7
			RTS

;-------
;
; Copy B bytes from @($A9) to @(X)
;
MEMCPY_xB_A9_X		STX	M00A7

;-------		fallthrough
;
; Copy B bytes from @($A9) to @($A7)
;
MEMCPY_xB_A9_A7
0			LDX	M00A9
			LDAA	,X
			INX
			STX	M00A9
			LDX	M00A7
			STAA	,X
			INX
			STX	M00A7
			DECB
			BNE	0B
			RTS

;-------

LO_CALL_03		TST	M756C
			BEQ	2F
			TST	>M00CC
			BNE	2F
			JSR	HI_CALL_00
			JSR	HI_CALL_01
			CLR	>M005A
			JSR	LCD_CLR_BOTTOM
			STX	M00A7
			LDX	#S_TRANSMITTING
			JSR	LCD_WRITE
			CLR	>M00C7
			JSR	HI_CALL_0E
1			LDAA	M777E
			DECA
			LDAB	#$20
			MUL
			ADDB	M00C7
			LDAA	#$4E
			MUL
			ADDD	#PRESET_VOICE
			XGDX
			JSR	F_9ACD
			LDAB	M00C7
			INCB
			STAB	M00C7
			CMPB	#$20
			BNE	1B
			JSR	MIDI_SYSEX_END
2			RTS

S_TRANSMITTING		FCC	"Transmitting!!  "
			FCB	$00

;-------

LO_CALL_04		LDAA	#$01
			STAA	M7791
			LDAA	M777E
			LDAB	#$4C
			MUL
			ADDD	#STANDARD_PFM
			XGDX
			STX	M00A9
			AIM	#~ECMI,TCSR3
			LDX	#M6DD7
			STX	M00A7
			JSR	LO_CALL_05
			JSR	HI_CALL_13
			JSR	HI_CALL_14
			RTS

;-------
;
; Initialise the user voices from a
; selection of the ROM presets
;
INIT_USER_VOICES	CLRB
1 			PSHB
			LDX	#D_INIT_USER_VOICE_LIST
			ABX
			LDAA	,X
			CMPA	#$80
			BCS	2F
			CLRA
2			LDAB	#$4E
			MUL
			ADDD	#PRESET_VOICE
			STD	M00A9
			PULB
			PSHB
			LDAA	#$4E
			MUL
			ADDD	#USER_VOICE
			XGDX
			LDAB	#$4E
			JSR	MEMCPY_xB_A9_X
			PULB
			INCB
			CMPB	#32
			BNE	1B
			RTS

D_INIT_USER_VOICE_LIST	FCB	$00,$08,$0C,$10,$18,$1E,$20,$22
			FCB	$29,$2F,$30,$34,$37,$3C,$3F,$40
			FCB	$41,$43,$48,$4A,$4E,$55,$57,$59
			FCB	$60,$61,$64,$67,$6F,$79,$7A,$7D

;-------

INIT_USER_PFMS		CLRB
			LDX	#USER_PFM
			STX	M00A7
1			PSHB
			LDAA	#$4C
			MUL
			ADDD	#PRESET_PFM
			STD	M00A9
			LDAB	#$4C
			JSR	MEMCPY_xB_A9_A7
			PULB
			INCB
			CMPB	#24
			BNE	1B
			RTS

; Standard performance settings  - 5 x 76 bytes per mode

STANDARD_PFM		FCB	$68,$00,$20,$00,$7F,$07,$18,$63,$60,$00,$41,$00,$7F
			FCB	$07,$18,$63,$60,$00,$62,$00,$7F,$07,$18,$63,$60,$00
			FCB	$63,$00,$7F,$07,$18,$63,$60,$00,$64,$00,$7F,$07,$18
			FCB	$63,$60,$00,$65,$00,$7F,$07,$18,$63,$60,$00,$66,$00
			FCB	$7F,$07,$18,$63,$60,$00,$67,$00,$7F,$07,$18,$63,$00
			FCB	$00
			FCC	"SINGLE    "

			FCB	$64,$00,$20,$00,$7F,$07,$18,$63,$64,$00,$40,$00,$7F
			FCB	$09,$18,$63,$60,$00,$62,$00,$7F,$07,$18,$63,$60,$00
			FCB	$63,$00,$7F,$07,$18,$63,$60,$00,$64,$00,$7F,$07,$18
			FCB	$63,$60,$00,$65,$00,$7F,$07,$18,$63,$60,$00,$66,$00
			FCB	$7F,$07,$18,$63,$60,$00,$67,$00,$7F,$07,$18,$63,$00
			FCB	$00
			FCC	"DUAL	   "

			FCB	$64,$00,$20,$3C,$7F,$07,$18,$63,$64,$00,$40,$00,$3B
			FCB	$07,$18,$63,$60,$00,$62,$00,$7F,$07,$18,$63,$60,$00
			FCB	$63,$00,$7F,$07,$18,$63,$60,$00,$64,$00,$7F,$07,$18
			FCB	$63,$60,$00,$65,$00,$7F,$07,$18,$63,$60,$00,$66,$00
			FCB	$7F,$07,$18,$63,$60,$00,$67,$00,$7F,$07,$18,$63,$00
			FCB	$00
			FCC	"SPLIT	   "

			FCB	$61,$00,$20,$00,$7F,$07,$18,$63,$61,$01,$41,$00,$7F
			FCB	$07,$18,$63,$61,$02,$62,$00,$7F,$07,$18,$63,$61,$03
			FCB	$63,$00,$7F,$07,$18,$63,$61,$04,$64,$00,$7F,$07,$18
			FCB	$63,$61,$05,$65,$00,$7F,$07,$18,$63,$61,$06,$66,$00
			FCB	$7F,$07,$18,$63,$61,$07,$67,$00,$7F,$07,$18,$63,$00
			FCB	$00
			FCC	"MONO8	   "

			FCB	$62,$00,$20,$00,$7F,$07,$18,$63,$62,$01,$41,$00,$7F
			FCB	$07,$18,$63,$62,$02,$62,$00,$7F,$07,$18,$63,$62,$03
			FCB	$63,$00,$7F,$07,$18,$63,$60,$04,$64,$00,$7F,$07,$18
			FCB	$63,$60,$05,$65,$00,$7F,$07,$18,$63,$60,$06,$66,$00
			FCB	$7F,$07,$18,$63,$60,$07,$67,$00,$7F,$07,$18,$63,$00
			FCB	$00
			FCC	"POLY4	   "

;-------

LO_CALL_01		JSR	F_8EBE
			LDAB	M7789
			CMPB	#11
			BCS	1F
			JMP	34F

1			JSR	JMPOFFB
			FCB	7F - *
			FCB	4F - *
			FCB	3F - *
			FCB	2F - *
			FCB	6F - *
			FCB	4F - *
			FCB	3F - *
			FCB	2F - *
			FCB	5F - *
			FCB	4F - *
			FCB	3F - *

2			JMP	F_8D3E		; case 3, 7
3			JMP	C_8B4A		; case 2, 6, 10
4			JMP	C_8ABD		; case 1, 5, 9
5			LDAB	M777E		; case 8
			ADDB	#$03
			BRA	9F
6			LDAB	#$02		; case 4
			BRA	9F
7			TST	M777E		; case 0
			BEQ	8F
			CLRB
			BRA	9F
8			LDAB	#$01
9			STAB	M00D7
			JSR	F_8EF2
			JSR	LCD_CLR_BOTTOM
			STX	M00A7
			LDX	#S_SAVE
			JSR	PUTSTRX
			JSR	F_8EB0
10			JSR	HI_CALL_17
			CMPB	#$02
			BNE	11F
			JMP	34F
11			CMPB	#$01
			BNE	10B
			JSR	LCD_CLR_BOTTOM
			STX	M00A7
			CLR	M6A15
			LDAB	M00D7
12			ASLB
			LDX	#DVEC_M8A6E
			ABX
			LDX	,X
			JSR	PUTSTRX
			LDX	#S_TO_TAPE
			JSR	LCD_WRITE
			LDAB	#$04
			LDX	#$0000
13			TIM	#SW5,PORT5
			BEQ	20F
			DEX
			BNE	13B
			DECB
			BNE	13B
			LDAA	M00D7
			CMPA	#$03
			BCS	14F
			CLR	>M00CD
			BRA	16F
14			CLRA
			STAA	M00CD
15			LDX	#LCD_BUFFER + 21
			STX	M00A7
			INCA
			CLRB
			JSR	PUT_DIGIT_2
			JSR	LCD_UPDATE
16			LDAA	M00CD
			JSR	F_903F
			LDAA	M00CD
			JSR	F_8A7E
			JSR	F_92F3
			STD	M6A17
			PSHB
			LDAB	M00D7
			CMPB	#$01
			BEQ	18F
			CMPB	#$02
			BNE	17F
			PULB
			STD	M6A0F
			BRA	19F
17			PULB
			STD	M6A0B
			BRA	19F
18			PULB
19			JSR	F_931B
			TST	>M00D3
			BEQ	21F
20			BRA	35F
21			LDAA	M00CD
			INCA
			STAA	M00CD
			LDAB	M00D7

			JSR	JMPOFFB
			FCB	22F - *
			FCB	22F - *
			FCB	23F - *
			FCB	25F - *
			FCB	30F - *
			FCB	27F - *
			FCB	30F - *
			FCB	28F - *

22			CMPA	#$20		; case 0, 1
			BRA	24F
23			CMPA	#$18		; case 2
24			BNE	15B
			BRA	30F
25			LDAB	M6A15		; case 3
			CMPB	#$02
			BEQ	28F
			CMPB	#$01
			BEQ	26F
			CMPA	#$04
			BNE	16B
26			JSR	LCD_CLR_BOTTOM
			STX	M00A7
			LDAB	M6A15
			INCB
			STAB	M6A15
			ADDB	#$05
			JMP	12B
27			CMPA	#$04		; case 5
			BRA	29F
28			CMPA	#$05		; case 7
29			BNE	16B
30			JSR	HI_CALL_06	; case 4, 6
			LDAA	M00D7
			CMPA	#$02
			BEQ	31F
			BCS	32F
			LDAA	#$09
			BRA	33F
31			LDAA	#$05
			BRA	33F
32			LDAA	#$01
33			STAA	M7789
34			CLI
			RTS

35			LDAA	M00D7
			CMPA	#$02
			BCS	36F
			LDAA	M777E
			DECA
			CMPA	#$05
			BCS	37F
			LDAA	#$04
			BRA	37F
36			LDAA	M777E
			INCA
			ANDA	#$01
37			STAA	M777E
			BRA	34B

DVEC_M8A6E		FDB	S_INT
			FDB	S_INT
			FDB	S_PFM_2
			FDB	S_PGM_CNG
			FDB	S_SYSTEM
			FDB	S_PGM_CNG
			FDB	S_EFFECT
			FDB	S_MICROTUN

;-------

F_8A7E			LDAA	M00CD
			LDAB	M00D7
			CMPB	#8
			BCS	1F
			CLRB

1			JSR	JMPOFFB
			FCB	9F - *
			FCB	2F - *
			FCB	3F - *
			FCB	4F - *
			FCB	5F - *
			FCB	6F - *
			FCB	7F - *
			FCB	8F - *

2			ADDA	#$20		; case 1
			BRA	9F
3			ADDA	#$40		; case 2
			STAA	M6A0E
			BRA	9F
4			LDAB	M6A15		; case 3
			BEQ	6F
			CMPB	#$01
			BEQ	7F
			BRA	8F
5			LDAA	#$60		; case 4
			BRA	9F
6			ADDA	#$61		; case 5
			BRA	9F
7			LDAA	#$65		; case 6
			BRA	9F
8			ADDA	#$66		; case 7
9			STAA	M6A0A		; case 0
			STAA	M6A16
			RTS

;-------

C_8ABD			JSR	LCD_CLR_BOTTOM
			STX	M00A7
			LDX	#S_VERIFY
			JSR	PUTSTRX
			JSR	F_8EB0
1			JSR	HI_CALL_17
			CMPB	#$02
			BEQ	9F
			CMPB	#$01
			BNE	1B
			CLR	M6A15
			JSR	LCD_CLR_BOTTOM
			STX	M00A7
			LDX	#S_VERIFY_TAPE
			JSR	PUTSTRX
			LDAB	M7789
			ANDB	#$0C
			CMPB	#$08
			BNE	2F
			LDX	#LCD_BUFFER + 29
			STX	M00A7
			JSR	F_8C1C
2			CLRA
			STAA	M00CD
3			JSR	F_8C82
			BCC	6F
			LDAA	M00D3
			CMPA	#$03
			BNE	4F
			JSR	F_8EF2
			CLR	>M00D3
			BRA	2B
4			JSR	F_9207
			BNE	8F
			LDAA	M00CD
			BNE	5F
			JSR	F_8EF2
			LDAA	M00CD
5			INCA
			STAA	M00CD
			JSR	F_8C34
			BCC	3B
			LDX	#LCD_BUFFER + 16
			STX	M00A7
			LDX	#S_VERIFY_COMPLETED
			JSR	LCD_WRITE
			JSR	HI_CALL_0D
			CLI
			LDAA	#$01
			STAA	M00CE
6			LDAA	M777E
			ANDA	#$0F
			DECA
			CMPA	#$05
			BCS	7F
			LDAA	#$04
7			STAA	M777E
			RTS
8			JMP	C_8CE9
9			JMP	C_8D03

C_8B4A
10			TST	M756D
			BEQ	11F
			JMP	26F
11			LDX	#LCD_BUFFER + 16
			STX	M00A7
			LDAB	M7789
			CMPB	#$0A
			BNE	12F
			LDX	#S_LOAD_READY
			BRA	13F
12			LDX	#S_LOAD_ALL_READY
13			JSR	LCD_WRITE
14			JSR	HI_CALL_17
			CMPB	#$02
			BNE	15F
			JMP	25F
15			CMPB	#$01
			BNE	14B
			JSR	LCD_CLR_BOTTOM
			STX	M00A7
			CLR	M6A15
			LDAB	M7789
			ANDB	#$0C
			BEQ	17F
			CMPB	#$04
			BEQ	16F
			LDX	#S_TAPE_TO
			JSR	PUTSTRX
			JSR	F_8C1C
			BRA	19F
16			LDX	#S_TAPE_TO_PFM
			BRA	18F
17			LDX	#S_TAPE_TO_INT
18			JSR	LCD_WRITE
19			CLR	>M00D3
			CLRA
			STAA	M00CD
20			JSR	F_8C82
			BCC	6B
			LDAA	M00D3
			CMPA	#$03
			BNE	21F
			JSR	F_8EF2
			BRA	19B
21			LDAA	M00CD
			JSR	F_90F5
			LDAA	M00CD
			BNE	22F
			JSR	F_8EF2
			LDAA	M00CD
22			INCA
			STAA	M00CD
			JSR	F_8C34
			BCC	20B
			LDX	#LCD_BUFFER + 16
			STX	M00A7
			LDX	#S_LOAD_COMPLETED
			JSR	LCD_WRITE
			CLI
			LDAB	M00D7
			CMPB	#$02
			BCS	24F
			BEQ	23F
			JSR	HI_CALL_09
			JSR	HI_CALL_00
			JSR	HI_CALL_01
			JSR	HI_CALL_0F
			JSR	HI_CALL_18
			JSR	HI_CALL_11
			AIM	#~ECMI,TCSR3
			JSR	HI_CALL_15
			JSR	HI_CALL_16
			OIM	#ECMI,TCSR3
23			JMP	C_8CF5
24			JSR	HI_CALL_1B
			JSR	HI_CALL_04
			JMP	C_8CF5
25			JMP	C_8D03
26			JSR	LCD_CLR_BOTTOM
			STX	M00A7
			LDX	#S_MEM_PROTECTED
			JSR	LCD_WRITE
			CLI
			JMP	C_8CF5

;------

F_8C1C			LDAB	M777E
			ASLB
			LDX	#1F
			ABX
			LDX	,X
			JSR	LCD_WRITE
			RTS

1			FDB	S_ALL
			FDB	S_SYS
			FDB	S_PC
			FDB	S_EF
			FDB	S_MC

;-------

F_8C34			LDAB	M00D7
			JSR	JMPOFFB
			FCB	1F - *
			FCB	1F - *
			FCB	2F - *
			FCB	4F - *
			FCB	12F - *
			FCB	4F - *
			FCB	7F - *
			FCB	5F - *

1			CMPA	#$20		; case 0, 1
			BRA	3F
2			CMPA	#$18		; case 2
3			BNE	11F
			BRA	12F
4			CMPA	#$04		; case 3, 5
			BRA	6F
5			CMPA	#$05		; case 7
6			BNE	11F
7			LDAB	M777E		; case 6
			ANDB	#$0F
			BNE	12F
			LDAB	M777E
			LDAA	M00D7
			CMPA	#$05
			BNE	8F
			ORAB	#$20
			BRA	10F
8			CMPA	#$06
			BNE	9F
			ORAB	#$40
			BRA	10F
9			ORAB	#$80
10			STAB	M777E
			ANDB	#$E0
			CMPB	#$E0
			BEQ	12F
			CLRA
			STAA	M00CD
11			CLC
			BRA	13F
12			SEC			; case 4
13			RTS

;-------

F_8C82			LDAB	M7789
			ANDB	#$0C
			CMPB	#$08
			BEQ	1F
			LDX	#LCD_BUFFER + 29
			STX	M00A7
			INCA
			CLRB
			JSR	PUT_DIGIT_2
			JSR	LCD_UPDATE
1			JSR	F_93D6
			LDAA	M00D3
			CMPA	#$02
			BCC	C_8CE9
			CMPA	#$01
			BEQ	C_8D03
			JSR	F_8ED4
			JSR	F_8D11
			LDAA	M00D3
			CMPA	#$03
			BEQ	8F
			LDAB	M00D7
			CMPB	#$03
			BCS	5F
			CMPB	#$04
			BNE	2F
			LDAB	#$60
			BRA	7F
2			CMPB	#$05
			BNE	3F
			LDAB	#$61
			BRA	6F
3			CMPB	#$06
			BNE	4F
			LDAB	#$65
			BRA	7F
4			LDAB	#$66
			BRA	6F
5			LDAA	#$20
			LDAB	M00D7
			MUL
6			ADDB	M00CD
7			CMPB	M6A16
			BNE	C_8CE9
			JSR	F_92F3
			SUBD	M6A17
			BNE	C_8CE9
8			SEC
			RTS

;-------

C_8CE9			LDX	#LCD_BUFFER + 28
			STX	M00A7
			LDX	#S_ERR
			JSR	LCD_WRITE
			CLI

;-------	fallthrough

C_8CF5			LDAA	#$01
			STAA	M00CE
			LDAA	M777E
			ANDA	#$0F
			STAA	M777E
			CLC
			RTS

;-------

C_8D03			CLI
			CLR	>M00CE
			LDAA	M777E
			ANDA	#$0F
			STAA	M777E
			CLC
			RTS

;-------

F_8D11			LDAB	M7789
			ANDB	#$0C
			LDAA	M00D7
			CMPA	#$02
			BEQ	2F
			BHI	3F
			TSTB
			BEQ	4F
1			LDAA	#$03
			STAA	M00D3
			BRA	4F
2			CMPB	#$04
			BNE	1B
			BRA	4F
3			CMPB	#$08
			BNE	1B
			LDAB	M777E
			ANDB	#$0F
			BEQ	4F
			ADDB	#$03
			SBA
			BNE	1B
4			RTS

;-------

F_8D3E			JSR	LCD_CLR_BOTTOM
			STX	M00A7
			LDX	#S_TAPE_TO_BUFF
			JSR	LCD_WRITE
1			JSR	HI_CALL_17
			CMPB	#$02
			BNE	2F
			JMP	29F

2			JSR	JMPOFF1
			FCB	3F - *
			FCB	$08
			FCB	4F - *
			FCB	$0A
			FCB	3F - *
			FCB	$00

3			BRA	1B
4			CLRA
5			LDAB	#$02
6			LDX	#$A000
7			DEX
			BNE	7B
			DECB
			BNE	6B
			STAA	M7EE8
			LDX	#LCD_BUFFER + 21
			STX	M00A7
			INCA
			CLRB
			JSR	PUT_DIGIT_2
			JSR	LCD_UPDATE
8			JSR	HI_CALL_17
			CMPB	#$02
			BNE	9F
			JMP	29F
9			CMPB	#$01
			BEQ	17F

			JSR	JMPOFF1
			FCB	10F - *
			FCB	$08
			FCB	11F - *
			FCB	$0A
			FCB	10F - *
			FCB	$00

10			BRA	8B
11			LDAA	M7EE8
			CMPB	#$08
			BEQ	14F
			INCA
			LDAB	M7789
			ANDB	#$0C
			CMPB	#$04
			BNE	12F
			CMPA	#$18
			BRA	13F
12			CMPA	#$20
13			BCS	16F
			CLRA
			BRA	16F
14			DECA
			BPL	16F
			LDAB	M7789
			ANDB	#$0C
			CMPB	#$04
			BNE	15F
			LDAA	#$17
			BRA	16F
15			LDAA	#$1F
16			BRA	5B
17			CLR	>M00D3
			JSR	LCD_CLR_BOTTOM
			STX	M00A7
			LDX	#S_SEARCH_TAPE
			JSR	LCD_WRITE
			LDX	#LCD_BUFFER + 29
			STX	M00A7
			LDAA	M7EE8
			INCA
			CLRB
			JSR	PUT_DIGIT_2
			JSR	LCD_UPDATE
18			CLRA
			STAA	M00CD
19			JSR	F_93D6
			LDAA	M00D3
			CMPA	#$02
			BCS	20F
			JMP	30F
20			CMPA	#$01
			BNE	21F
			JMP	29F
21			JSR	F_8ED4
			JSR	F_8D11
			LDAA	M00D3
			CMPA	#$03
			BNE	22F
			JSR	F_8EF2
			CLR	>M00D3
			BRA	18B
22			LDAA	#$20
			LDAB	M00D7
			MUL
			ADDB	M7EE8
			CMPB	M6A16
			BEQ	23F
			JMP	28F
23			JSR	F_92F3
			SUBD	M6A17
			BEQ	24F
			JMP	30F
24			JSR	F_8EF2
			LDAB	M7789
			ANDB	#$0C
			BEQ	25F
			AIM	#~ECMI,TCSR3
			JSR	F_90E5
			LDX	#M69C1
			STX	M00A9
			LDX	#M6DD7
			STX	M00A7
			JSR	LO_CALL_05
			JSR	LO_CALL_0B
			LDAA	#$01
			STAA	M7791
			BRA	27F
25			AIM	#~ECMI,TCSR3
			LDAB	M7773
			JSR	HI_CALL_19
			JSR	F_90D5
			LDX	#M69C1
			STX	M00A9
			LDX	#M6A67
			STX	M00A7
			JSR	LO_CALL_00
			TST	>M00D7
			BNE	26F
			JSR	HI_CALL_12
26			JSR	LO_CALL_09
			JSR	HI_CALL_05
			LDAA	#$01
			STAA	M7792
			CLR	M7793
			LDD	#$0101
			STD	M776E
			STD	M7770
			OIM	#ECMI,TCSR3
27			LDX	#LCD_BUFFER + 16
			STX	M00A7
			LDX	#S_LOAD_COMPLETED
			JSR	LCD_WRITE
			JSR	HI_CALL_0A
			CLI
			LDAA	#$01
			STAA	M00CE
			RTS
28			LDAA	M00CD
			INCA
			STAA	M00CD
			CMPA	#$20
			BEQ	29F
			JMP	19B
29			CLI
			CLR	>M00CE
			RTS
30			JMP	C_8CE9

;-------

F_8EB0			CLR	>M00D3
			LDX	#LCD_BUFFER + 25
			STX	M00A7
			LDX	#S_READY
			JMP	LCD_WRITE

;-------

F_8EBE			JSR	HI_CALL_00
			SEI
			JSR	HI_CALL_01
			CLR	>M005A
			LDAB	#$0C
			JSR	LCD_WAIT
			STAB	LCD_CMD
			JSR	MIDI_INIT_RX
			RTS

;-------

F_8ED4			LDAA	M6A0A
			STAA	M6A16
			LDAA	M00D7
			BEQ	1F
			CMPA	#$03
			BCC	1F
			CMPA	#$02
			BNE	3F
			LDD	M6A0F
			BRA	2F
1			LDD	M6A0B
2			STD	M6A17
3			RTS

;-------

F_8EF2			LDX	#LCD_BUFFER + 9
			STX	M00A7
			LDAB	#$07
			JSR	PUTSPACES
			LDX	#LCD_BUFFER + 11
			STX	M00A7
			LDX	#1F
			LDAB	M00D7
			ASLB
			ABX
			LDX	,X
			JSR	LCD_WRITE
			RTS

1			FDB	S_DX
			FDB	S_TX
			FDB	S_PFM
			FDB	S_AL_2
			FDB	S_SY_2
			FDB	S_PC_2
			FDB	S_EF_2
			FDB	S_MC_2

;-------

S_READY			FCC	"ready? "
			FCB	$00
S_VERIFY		FCC	" Verify"
			FCB	$00
S_SAVE			FCC	" Save"
			FCB	$00
S_INT			FCC	" INT	 "
			FCB	$00
S_ERR			FCC	" ERR"
			FCB	$00
S_VERIFY_TAPE		FCC	" Verify Tape"
			FCB	$00
S_TAPE_TO_INT		FCC	" Tape to INT"
			FCB	$00
S_VERIFY_COMPLETED	FCC	"Verify Completed"
			FCB	$00
S_LOAD_ALL_READY	FCC	"Load all  ready?"
			FCB	$00
S_LOAD_READY		FCC	"Load	 ready?  "
			FCB	$00
S_TAPE_TO_BUFF		FCC	"Tape ?? to BUFF?"
			FCB	$00
S_SEARCH_TAPE		FCC	" Search Tape  "
			FCB	$00
S_LOAD_COMPLETED	FCC	" Load Completed "
			FCB	$00
S_PFM			FCC	"(PFM)"
			FCB	$00
S_TAPE_TO_PFM		FCC	" Tape to PFM"
			FCB	$00
S_PFM_2			FCC	" PFM	 "
			FCB	$00
S_TO_TAPE		FCC	"to Tape"
			FCB	$00
S_TAPE_TO		FCC	" Tape to "
			FCB	$00
S_PGM_CNG		FCC	" PGMCNG "
			FCB	$00
S_SYSTEM		FCC	" SYSTEM "
			FCB	$00
S_EFFECT		FCC	" EFFECT "
			FCB	$00
S_MICROTUN		FCC	" MICTUN "
			FCB	$00

S_ALL			FCC	"ALL"
			FCB	$00
S_SYS			FCC	"SYS"
			FCB	$00
S_PC			FCC	"PC "
			FCB	$00
S_EF			FCC	"EF "
			FCB	$00
S_MC			FCC	"MC "
			FCB	$00

S_AL_2			FCC	"(AL)"
			FCB	$00
S_SY_2			FCC	"(SY)"
			FCB	$00
S_PC_2			FCC	"(PC)"
			FCB	$00
S_EF_2			FCC	"(EF)"
			FCB	$00
S_MC_2			FCC	"(MC)"
			FCB	$00

;--------

F_903F			LDX	#M69C1
			STX	M0079
			LDAB	M00D7
			JSR	JMPOFFB
			FCB	1F - *
			FCB	1F - *
			FCB	2F - *
			FCB	3F - *
			FCB	4F - *
			FCB	5F - *
			FCB	7F - *
			FCB	8F - *

1			LDAB	#$4E		; case 0, 1
			MUL
			ADDD	#USER_VOICE
			STD	M0077
			JMP	F_9196

2			LDAB	#$4C		; case 2
			MUL
			ADDD	#USER_PFM
			STD	M0077
			LDAB	#$49
			JSR	MEMCPY_xB_77_79
			LDX	M0079
			INX
			STX	M0079
			LDAB	#$03
			JMP	MEMCPY_xB_77_79
3			LDAB	M6A15		; case 3
			BEQ	5F
			CMPB	#$01
			BEQ	7F
			BRA	8F
4			LDX	#M7565		; case 4
			STX	M0077
			LDAB	#$0B
			JSR	MEMCPY_xB_77_79
			LDX	#M7740
			STX	M0077
			LDAB	#$10
			JSR	MEMCPY_xB_77_79
			LDAB	#$2E
			JMP	MEMCLR_xB_79
5			LDAB	#$40		; case 5
			MUL
			ADDD	#M7571
			STD	M0077
6			LDAB	#$40
			JSR	MEMCPY_xB_77_79
			LDAB	#$09
			JMP	MEMCLR_xB_79
7			LDX	#M75F1		; case 6
			STX	M0077
			LDAB	#$37
			JSR	MEMCPY_xB_77_79
			LDAB	#$12
			JMP	MEMCLR_xB_79
8			TSTA			; case 7
			BNE	9F
			LDX	#M7628
			STX	M0077
			LDAB	#$18
			JSR	MEMCPY_xB_77_79
			LDAB	#$31
			JMP	MEMCLR_xB_79
9			DECA
			LDAB	#$40
			MUL
			ADDD	#M7640
			STD	M0077
			BRA	6B

;-------

F_90D5			LDX	#M6A0B
			STX	M0077
			LDX	#M6A04
			STX	M0079
			LDAB	#$0B
			JSR	MEMCPY_xB_77_79
			RTS

;-------

F_90E5			LDX	#M6A0B
			STX	M0077
			LDX	#M6A0A
			STX	M0079
			LDAB	#$03
			JSR	MEMCPY_xB_77_79
			RTS

;-------

F_90F5			LDX	#M69C1
			STX	M0077
			LDAB	M00D7
			JSR	JMPOFFB
			FCB	1F - *
			FCB	1F - *
			FCB	2F - *
			FCB	4F - *
			FCB	3F - *
			FCB	4F - *
			FCB	6F - *
			FCB	7F - *

1			LDAB	#$4E		; case 0, 1
			MUL
			ADDD	#USER_VOICE
			STD	M0079
			JSR	MEMCPY_43_77_79
			TST	>M00D7
			BEQ	9F
			LDX	#M6A0B
			STX	M0077
			LDAB	#$0B
			JSR	MEMCPY_xB_77_79
			RTS
2			LDAB	#$4C
			MUL
			ADDD	#USER_PFM
			STD	M0079
			LDAB	#$49
			JSR	MEMCPY_xB_77_79
			LDX	#M6A0B
			STX	M0077
			LDAB	#$03
			JSR	MEMCPY_xB_77_79
			RTS
3			LDX	#M7565		; case 4
			STX	M0079
			LDAB	#$0B
			JSR	MEMCPY_xB_77_79
			LDX	#M7740
			STX	M0079
			LDAB	#$10
			JSR	MEMCPY_xB_77_79
			RTS
4			CMPA	#$02		; case 3, 5
			BCC	5F
			LDAB	#$40
			MUL
			ADDD	#M7571
			STD	M0079
			LDAB	#$40
			JSR	MEMCPY_xB_77_79
5			RTS
6			LDX	#M75F1		; case 6
			STX	M0079
			LDAB	#$37
			JSR	MEMCPY_xB_77_79
			RTS
7			TSTA			; case 7
			BNE	8F
			LDX	#M7628
			STX	M0079
			LDAB	#$18
			JSR	MEMCPY_xB_77_79
			RTS
8			DECA
			LDAB	#$40
			MUL
			ADDD	#M7640
			STD	M0079
			LDAB	#$40
			JSR	MEMCPY_xB_77_79
			RTS
9			LDAB	#$0B
10			LDX	M0079
			CLR	,X
			INX
			STX	M0079
			DECB
			BNE	10B
			RTS

;-------

F_9196			CLRB
1			LDX	M0077
			LDAA	,X
			CMPB	#$43
			BCS	4F
			CMPB	#$46
			BCS	3F
			CMPB	#$49
			BEQ	8F
			BCS	2F
			CMPB	#$50
			BNE	7F
			ANDA	#$0F
			BRA	7F
2			LDAA	#$32
			BRA	8F
3			LDAA	#$63
			BRA	8F
4			CMPB	#$30
			BNE	7F
			TIM	#$04,$00,X
			BNE	5F
			ANDA	#$FB
			ORAA	#$02
			BRA	6F
5			ORAA	#$04
			ANDA	#$FD
6			ANDA	#$0F
7			INX
			STX	M0077
8			LDX	M0079
			STAA	,X
			INX
			STX	M0079
			INCB
			TST	M777E
			BNE	9F
			CMPB	#$55
			BRA	10F
9			CMPB	#$49
10			BNE	1B
			RTS

;-------

MEMCPY_43_77_79		LDAB	#$43

;-------		fallthrough

MEMCPY_xB_77_79
0			LDX	M0077
			LDAA	,X
			INX
			STX	M0077
			LDX	M0079
			STAA	,X
			INX
			STX	M0079
			DECB
			BNE	0B
			RTS

;-------

MEMCLR_xB_79		CLRA
1			LDX	M0079
			STAA	,X
			INX
			STX	M0079
			DECB
			BNE	1B
			RTS

;-------

F_9207			LDX	#M69C1
			STX	M0077
			LDAA	M00CD
			LDAB	M00D7
			JSR	JMPOFFB
			FCB	4F - *
			FCB	4F - *
			FCB	1F - *
			FCB	10F - *
			FCB	15F - *
			FCB	10F - *
			FCB	12F - *
			FCB	13F - *

1			LDAB	#$4C		; case 2
			MUL
			ADDD	#USER_PFM
			STD	M0079
			CLRB
2			LDX	M0077
			LDAA	,X
			INX
			STX	M0077
			LDX	M0079
			SUBA	,X
			BNE	9F
			INX
			STX	M0079
			INCB
			CMPB	#$49
			BCS	2B
			BHI	3F
			LDX	#M6A0B
			STX	M0077
			BRA	2B
3			CMPB	#$4C
			BCS	2B
			BRA	9F
4			LDAB	#$4E		; case 0, 1
			MUL
			ADDD	#USER_VOICE
			STD	M0079
			CLRB
5			LDX	M0077
			LDAA	,X
			INX
			STX	M0077
			LDX	M0079
			CMPB	#$30
			BNE	6F
			EORA	,X
			ANDA	#$0D
			BNE	9F
			BRA	7F
6			SUBA	,X
			BNE	9F
7			INX
			STX	M0079
			INCB
			CMPB	#$43
			BCS	5B
			BHI	8F
			LDAA	M00D7
			BEQ	9F
			CMPA	#$01
			BNE	9F
			LDX	#M6A0B
			STX	M0077
			BRA	5B
8			CMPB	#$4E
			BNE	5B
9			RTS
10			CMPA	#$02		; case 3, 5
			BCC	11F
			LDAB	#$40
			MUL
			ADDD	#M7571
			STD	M0079
			LDAB	#$40
			BRA	17F
11			CLRB			; case 6
			BRA	9B
12			LDX	#M75F1		; case 4
			STX	M0079
			LDAB	#$37
			BRA	17F
13			TSTA			; case 7
			BNE	14F
			LDX	#M7628
			STX	M0079
			LDAB	#$18
			BRA	17F
14			DECA
			LDAB	#$40
			MUL
			ADDD	#M7640
			STD	M0079
			LDAB	#$40
			BRA	17F
15			LDX	#M7565
			STX	M0079
			LDAB	#$0B
16			LDX	M0077
			LDAA	,X
			INX
			STX	M0077
			LDX	M0079
			SUBA	,X
			BNE	9B
			INX
			STX	M0079
			DECB
			BNE	16B
			LDX	#M7740
			STX	M0079
			LDAB	#$10
17			LDX	M0077
			LDAA	,X
			INX
			STX	M0077
			LDX	M0079
			SUBA	,X
			BNE	9B
			INX
			STX	M0079
			DECB
			BNE	17B
			BRA	9B

;-------

F_92F3			LDX	#M69C1
			LDAB	M00D7
			BEQ	1F
			CMPB	#$03
			BCS	2F
1			LDAB	#$4A
			BRA	4F
2			CMPB	#$01
			BNE	3F
			LDAB	#$56
			BRA	4F
3			LDAB	#$4E
4			STAB	M007B
			CLRA
			CLRB
5			ADDB	,X
			ADCA	#$00
			INX
			DEC	>M007B
			BNE	5B
			RTS

;-------

F_931B			LDX	#M69C1
			LDAB	M00D7
			CMPB	#$01
			BNE	1F
			LDAB	#$58
			BRA	3F
1			CMPB	#$02
			BNE	2F
			LDAB	#$50
			BRA	3F
2			LDAB	#$4C
3			STAB	M00CF
			BSR	F_934A
			LDAB	#$3C
			SPIN4F
5			LDAA	,X
			BSR	F_939D
			LDAB	#$3B
			PSHX
			PULX
			INX
			DEC	>M00CF
			BNE	5B
			RTS

;-------

F_934A			PSHA
			PSHB
			PSHX
			TST	>M00CD
			BNE	1F
			LDX	#6000
			BRA	2F
1			LDX	#300
2			LDAB	#30
			SPIN4F
			DES
			BSR	F_936A
			INS
			DEX
			BNE	2B
			PULX
			PULB
			PULA
			RTS

;-------

F_936A			LDAA	#$01
			BSR	F_9383
			BSR	F_9381
			BSR	F_9381
			BSR	F_9381
			RTS

;-------

F_9375			LDAA	#$01
			BSR	F_9383
			LDAB	#$41
			PSHX
			PULX
			NOP
			BSR	F_9383
			RTS

;-------

F_9381			LDAB	#$20

;-------		fallthrough

F_9383
0			TIM	#SW5,PORT5		; test DEC switch
			BEQ	2F
			DECB
			BNE	0B
			SPIN4F
			EORA	#CASS_OUT
			STAA	PORT2
			RTS
2			LDAA	#$01
			STAA	M00D3
			TSX
			LDAB	#$0B
			ABX
			TXS
			RTS

;-------

F_939D			PSHA
			PSHB
			PSHX
			LDX	#TCSR1
			PSHA
			BSR	F_9375
			PULA
			SPIN3F
1			SPIN4F
3			NOP
			NOP
			RORA
			PSHA
			BCS	4F
			LDAB	#$3F
			BSR	F_9375
			BRA	5F
4			LDAB	#$1D
			BSR	F_936A
			BRA	5F
5			PULA
			DEX
			BNE	3B
			LDAB	#$1D
			PSHX
			PULX
			NOP
			DES
			BSR	F_936A
			LDAB	#$1E
			PSHX
			PULX
			NOP
			BSR	F_936A
			INS
			PULX
			PULB
			PULA
			RTS

;-------

F_93D6			CLR	>M00D7
			LDX	#M69C1
			JSR	F_9467
			BCS	1F
			JMP	14F
1			JSR	F_9481
			BCC	14F
			LDAA	#$80
			STAA	M00D2
			JSR	F_94DE
			BCC	14F
			LDAA	M00D2
			STAA	,X
			INX
2			JSR	F_94AD
			BCC	14F
			LDAA	M00D2
			STAA	,X
			INX
			LDAB	M00D7
			BEQ	4F
			CMPB	#$04
			BCC	4F
			CMPB	#$01
			BNE	3F
			CPX	#M6A19
			BNE	2B
			BRA	13F
3			CMPB	#$02
			BNE	12F
			CPX	#M6A11
			BNE	2B
			BRA	13F
4			CPX	#M6A0D
			BNE	2B
			LDAA	M6A0A
			ANDA	#$E0
			BEQ	13F
			CMPA	#$20
			BNE	5F
			LDAB	#$01
			BRA	11F
5			CMPA	#$40
			BNE	6F
			LDAB	#$02
			BRA	11F
6			LDAA	M6A0A
			CMPA	#$60
			BNE	7F
			LDAB	#$04
			BRA	10F
7			CMPA	#$65
			BEQ	8F
			BHI	9F
			LDAB	#$05
			BRA	10F
8			LDAB	#$06
			BRA	10F
9			LDAB	#$07
10			STAB	M00D7
			BRA	13F
11			STAB	M00D7
			BRA	2B
12			LDAB	#$02
			STAB	M00D3
			CLC
			BRA	14F
13			SEC
14			RTS

;-------

F_9467
0			CLRA
			STAA	M00D1
1			BSR	F_9493
			BCC	2F
			BSR	F_9494
			BCC	2F
			CMPB	#$38
			BCC	0B
			CMPB	#$11
			BCS	0B
			INC	>M00D1
			BNE	1B
			SEC
2			RTS

;-------

F_9481			CLR	>M00D4
1			BSR	F_9493
			BCC	2F
			TBA
			ADDA	M00D4
			STAB	M00D4
			CMPA	#$41
			BCS	1B
			SEC
2			RTS

;-------

F_9493			CLRB

;-------		fallthrough

F_9494
0			TIM	#SW5,PORT5		; test DEC switch
			BEQ	1F
			INCB
			LDAA	PORT2
			ANDA	#CASS_IN
			EORA	M00D5
			BEQ	0B
			EIM	#$02,M00D5
			SEC
			RTS
1			LDAA	#$01
			STAA	M00D3
			CLC
			RTS

;-------

F_94AD			LDAA	#$80
			STAA	M00D2
			BSR	F_951E
			BCC	6F
1			CLRB
2			INCB
			BEQ	6F
			TIM	#SW5,PORT5
			BEQ	5F
			LDAA	PORT2
			ANDA	#CASS_IN
			EORA	M00D5
			BEQ	2B
3			INCB
			BEQ	6F
			TIM	#SW5,PORT5
			BEQ	5F
			LDAA	PORT2
			ANDA	#$02
			EORA	M00D5
			BNE	3B
			CMPB	#$66
			BCC	6F
			CMPB	#$33
			BCS	1B

;-------	fallthrough

F_94DE			BSR	F_94FA
			BCC	6F
			LDAA	M00D6
			CMPA	#$04
			BCC	6F
			RORA
			RORA
			ROR	>M00D2
			BCC	F_94DE
			RTS

5			LDAA	#$01
			BRA	7F
6			LDAA	#$02
7			STAA	M00D3
			CLC
			RTS

;-------

F_94FA			LDAA	PORT2
			ANDA	#CASS_IN
			STAA	M00D0
			CLR	>M00D6
			LDAB	#$28
1			LDAA	PORT2
			ANDA	#CASS_IN
			EORA	M00D0
			BEQ	3F
			INC	>M00D6
			EIM	#$02,M00D0
2			DECB
			BNE	1B
			LDAA	M00D0
			BRA	6F
3			PSHX
			PULX
			BRA	2B

;------- fallthrough

F_951E			CLRB
5			INCB
			TSTB
			BEQ	8F
			LDAA	PORT2
			ANDA	#CASS_IN
6			EORA	M00D5
			BEQ	5B
7			INCB
			TSTB
			BEQ	8F
			LDAA	PORT2
			ANDA	#CASS_IN
			EORA	M00D5
			BNE	7B
			SEC
8			RTS

;-------

LO_CALL_02		LDAA	#$00
			STAA	M7772
			CLR	POLL_ENABLE
			LDD	#$0101
			STD	M776E
			STD	M7770
			LDAA	#$40
			STAA	M7565
			JSR	HI_CALL_00
			JSR	HI_CALL_01
			CLR	>M005A
			JSR	F_9998
			JSR	HI_CALL_1A
			JSR	LCD_CLR
			LDAA	M00A6
			CMPA	#$03
			BNE	2F
			LDAA	#$04
			STAA	M7772
			JSR	DELAY_30_x_4500
			LDAA	#$04
			STAA	M00D8
			CLR	>M00D9
			JSR	F_96C4
			SEI
1			SPIN3
			JSR	MIDI_INIT
			CLI
			JMP	4F
2			LDX	#LCD_BUFFER
			STX	M00A7
			LDX	#S_CHECK_LVL
			JSR	PUTSTRX
			LDAA	#$FE
			STAA	M7D63
			CLR	M7D53
			CLR	M776D
			CLR	M7D6B
			CLR	M7F99
			AIM	#~ECMI,TCSR3
			AIM	#%11110111,TCSR1
			AIM	#%11111110,RP5CR
			LDAA	#$04
			STAA	M0058
			LDAA	#$45
			STAA	M0052
			LDAA	#$30
			STAA	M00F1
			LDAB	#$00
			JSR	HI_CALL_1D
			OIM	#%00000001,RP5CR
			OIM	#%00001000,TCSR1
			OIM	#ECMI,TCSR3
			CLR	M7933
			CLRA
			LDAB	#$30
			BSR	OPZ_WRITE_BA
			CLRA
			LDX	#S_1L
			BSR	F_9604
			LDAA	#$80
			LDX	#S_2R
			BSR	F_9604
			CLRA
			LDX	#S_HP_L
			BSR	F_9604
			LDAA	#$80
			LDX	#S_HP_R
			BSR	F_9604
			AIM	#~ECMI,TCSR3
			AIM	#%11110111,TCSR1
			LDAA	#$04
			STAA	M0058
			LDAA	#$45
			STAA	M0051
			LDAB	#$00
			JSR	HI_CALL_1C
			OIM	#%00001000,TCSR1
			OIM	#ECMI,TCSR3
			LDAA	#$04
			STAA	M7772
			BRA	LO_CALL_02_PT2

;-------

F_9604			PSHA
			PSHX
			LDX	#LCD_BUFFER + 11
			STX	M00A7
			PULX
			JSR	LCD_WRITE
			PULA
			BSR	OPZ_WRITE_20
1001			JSR	HI_CALL_17
			CMPB	#$01
			BNE	1001B
			JSR	DELAY_30_x_4500
			RTS

;-------

OPZ_WRITE_20		LDAB	#$20

;-------	fallthrough

OPZ_WRITE_BA		SEI
			SPIN3
			OPZ_POLL
			OPZ_OUT_A
			CLI
			RTS

;-------

S_1L			FCC	"1(L)"
			FCB	$00
S_2R			FCC	"2(R)"
			FCB	$00
S_HP_L			FCC	"HP(L)"
			FCB	$00
S_HP_R			FCC	"HP(R)"
			FCB	$00

;-------
;
; LO_CALL_02 continues

LO_CALL_02_PT2		JSR	LCD_CLR
			SEI
3			SPIN3
			CLRA
			STAA	TCSR1
			STAA	TCSR2
			LDAA	#$02
			STAA	TCSR3
			AIM	#%11111110,RP5CR
			JSR	F_96C4
			JSR	F_9700
			JSR	F_97E2
			JSR	MIDI_INIT
			CLI
			JSR	F_978D
			LDAA	#$52
			STAA	TCSR3
4			LDAA	M00D8
			BNE	5F
			JSR	F_9852
			BRA	10F
5			CMPA	#$01
			BNE	6F
			JSR	F_9893
			BRA	10F
6			CMPA	#$02
			BNE	7F
			JSR	F_9883
			BRA	10F
7			CMPA	#$03
			BNE	8F
			JSR	TEST_LEDS
			BRA	10F
8			CMPA	#$04
			BNE	9F
			JSR	F_9907
			BRA	4B
9			CMPA	#$05
			BNE	10F
			JSR	F_9914
			BRA	11F
10			JSR	HI_CALL_17
			JSR	F_96AD
			BRA	4B
11			RTS

;-------

F_96AD			TSTB
			BEQ	1F
			CMPB	#$01
			BEQ	2F
1			RTS
2			LDAA	M00D8
			CMPA	#$05
			BHI	F_96AD
			INC	>M00D8
			CLR	>M00D9
			JMP	LCD_CLR

;-------

F_96C4			CLR	M7773
			CLR	M7779
			LDAA	#$01
			STAA	POLL_ENABLE
			STAA	M7569
			STAA	M756A
			STAA	M7568
			STAA	M756C
			LDAA	#$10
			STAA	M7566
			CLR	M7567
			CLR	M756B
			CLR	M756F
			LDAB	#$40
			LDAA	#$0A
1			COMA
			JSR	LCD_WAIT
			STAB	LCD_CMD
			JSR	LCD_WAIT
			STAA	LCD_DATA
			INCB
			CMPB	#$48
			BNE	1B
			RTS

;-------

F_9700			LDX	#RAM
			STX	M00A9
			LDX	#$00F8
			STX	M00A7
1			BSR	F_9718
			BSR	F_9744
			BSR	F_9723
			LDX	M00A9
			CPX	#M7FE0
			BCS	1B
			RTS

;-------

F_9718			LDX	M00A9
			STX	M00DA
			LDX	M00A7
			STX	M00DC
			BSR	F_9733
			RTS

;-------

F_9723			LDX	M00A7
			STX	M00DA
			LDX	M00A9
			STX	M00DC
			BSR	F_9733
			LDX	M00A9
			ABX
			STX	M00A9
			RTS

;-------

F_9733			CLRB
1			LDX	M00DA
			ABX
			LDAA	,X
			LDX	M00DC
			ABX
			STAA	,X
			INCB
			CMPB	#$08
			BNE	1B
			RTS

;-------

F_9744			CLRB
1			LDX	M00A9
			ABX
			LDAA	#$55
			BSR	F_9756
			LDAA	#$AA
			BSR	F_9756
			INCB
			CMPB	#$08
			BNE	1B
			RTS

;-------

F_9756			STAA	,X
			CMPA	,X
			BNE	1F
			RTS
1			LDAA	#$0E
			PSHA
			LDX	#S_IC_NG
			JSR	LCD_OUT
			PULA
			LDX	#LCD_BUFFER + 3
			STX	M00A7
			JSR	PUT_DIGIT_2
			JSR	LCD_UPDATE
2			BRA	2B

;-------

S_CHECK_LVL		FCC	"Check LVL"
			FCB	$00

S_IC_NG			FCC	" IC   is NG ! "
			FCB	$00

;-------

F_978D			LDAB	#$0A
1			LDX	#MIDI_RXBUF
			ABX
			CLR	,X
			DECB
			BNE	1B
			CLRB
2			LDX	#S_TX81Z
			ABX
			LDAA	,X
			BEQ	3F
			JSR	MIDI_TX
			INCB
			BRA	2B
3			LDAB	#$01
			JSR	DELAY_B_x_4500
			LDX	#S_TX81Z
			STX	M00A9
			LDX	#MIDI_RXBUF
			STX	M00A7
4			LDX	M00A9
			ABX
			LDAA	,X
			BEQ	5F
			LDX	M00A7
			ABX
			CMPA	,X
			BNE	6F
			INCB
			BRA	4B
5			RTS
6			LDX	#S_ERROR_MIDI
			JSR	LCD_OUT
7			BRA	7B

;-------

S_ERROR_MIDI		FCC	"ERROR MIDI!"
			FCB	$00

S_TX81Z			FCC	"TX81Z"
			FCB	$00

;-------

F_97E2			CLRB
1			EIM	#CASS_OUT,PORT2
			BSR	F_981B
			LDAA	PORT2
			ANDA	#$02
			STAA	M00D0
			DECB
			BNE	1B
			LDAB	#$80
2			EIM	#CASS_OUT,PORT2
			BSR	F_9824
			DECB
			BNE	2B
			LDAA	M00DE
			CMPA	#$7E
			BCS	4F
			CMPA	#$83
			BCC	4F
3			RTS
4			LDX	#S_ERROR_CASS
			JSR	LCD_OUT
			LDAA	M00A6
			CMPA	#$02
5			BNE	5B
6			JSR	HI_CALL_17
			CMPB	#$02
			BNE	6B
			BRA	3B

;-------

F_981B			LDX	#$009F
			NOP
			NOP
1			DEX
			BNE	1B
			RTS

;-------

F_9824			LDX	#$15
1			LDAA	PORT2
			ANDA	#CASS_IN
			EORA	M00D0
			BEQ	2F
			EORA	M00D0
			STAA	M00D0
			INC	>M00DE
			BRA	3F
2			PSHX
			PULX
			SPIN3
			SPIN3
3			DEX
			BNE	1B
			PSHX
			PULX
			NOP
			RTS

;-------

S_ERROR_CASS		FCC	"ERROR CASS.!"
			FCB	$00

;-------

F_9852			LDX	#S_CHECK_MIDI_THRU
			JSR	LCD_OUT
			LDAA	#$AA
			JSR	MIDI_TX
			LDAA	#$FF
			JSR	MIDI_TX
			CLRA
			JSR	MIDI_TX
			LDAA	#$55
			JSR	MIDI_TX
			LDX	#$A000
1			DEX
			BNE	1B
			RTS

S_CHECK_MIDI_THRU	FCC	"Check MIDI THRU "
			FCB	$00

;-------

F_9883			CLRA
			CLRB
1			LDX	#LCD_BUFFER
			ABX
			STAA	,X
			INCB
			CMPB	#$20
			BNE	1B
			JMP	LCD_UPDATE

;-------

F_9893			LDAA	M00D9
			ANDA	#$01
			BNE	2F
			LDAA	#$20
			CLRB
1			LDX	#LCD_BUFFER
			ABX
			STAA	,X
			INCB
			CMPB	#$20
			BNE	1B
			JSR	LCD_UPDATE
			LDAA	M00D9
			CMPA	#$05
			BCC	1000F
			INCA
			STAA	M00D9
			BRA	DELAY_30_x_4500
2			LDAA	#$FF
			CLRB
			BRA	1B

;-------	fallthrough

DELAY_30_x_4500		LDAB	#30

;-------	fallthrough

DELAY_B_x_4500
0			LDX	#4500
1			DEX
			BNE	1B
			DECB
			BNE	0B
1000			RTS

;-------

TEST_LEDS		TST	>M00D9
			BNE	3F
			LDAA	#$01
			STAA	POLL_ENABLE
			STAA	M7569
			STAA	M00D9
			LDX	#S_CHECK_LED
			JSR	LCD_OUT
			CLRB
1			LDAA	#LED4
2			ANDA	#~BANKSEL
			STAA	PORT6
			LSRA
			PSHB
			LDAB	#30
			JSR	DELAY_B_x_4500
			PULB
			INCB
			CMPB	#4
			BEQ	1B
			CMPB	#8
			BNE	2B
			LDAA	#(LED4|LED3|LED2|LED1)
			ANDA	#~BANKSEL
			STAA	PORT6
3			RTS

S_CHECK_LED		FCC	"Check LED1-4"
			FCB	$00

;-------

F_9907			SPIN3
			SPIN3
			INC	>M00D8
			CLR	>M00D9
			JMP	LCD_CLR

F_9914			TST	>M00D9
			BNE	1F
			CLR	>M00DA
			LDX	#S_PUSH_SWITCH
			JSR	LCD_OUT
1			LDAA	M00D9
			INCA
			CLRB
			LDX	#LCD_BUFFER + 12
			STX	M00A7
			JSR	PUT_DIGIT_2
			JSR	LCD_UPDATE
			JSR	HI_CALL_17
			TSTB
			BNE	2F
			CLR	>M00DA
			BRA	1B
2			CMPB	#$03
			BCS	7F
			CMPB	#$04
			BCS	8F
			BEQ	1B
			CMPB	#$0A
			BCS	9F
			CMPB	#$0D
			BCS	10F
			BRA	1B
3			CMPB	M00D9
			BEQ	4F
			LDAB	#$01
			STAB	M00DA
			BRA	1B
4			TST	>M00DA
			BEQ	6F
			DEC	>M00D9
			TST	>M00D9
5			BMI	5B
			CLR	>M00DA
			BRA	1B
6			LDAB	#$01
			STAB	M00DA
			INC	>M00D9
			LDAB	M00D9
			CMPB	#$0B
			BNE	1B
			JMP	hdlr_RST
7			COMB
			SUBB	#$F7
			BRA	3B
8			CLRB
			BRA	3B
9			SUBB	#$04
			BRA	3B
10			SUBB	#$02
			BRA	3B

S_PUSH_SWITCH		FCC	"Push Switch"
			FCB	$00

;-------

F_9998			JSR	INIT_USER_VOICES
			JSR	INIT_USER_PFMS
			LDX	#D_99C9
			STX	M00A9
			LDAB	#$37
			LDX	#M75F1
			JSR	MEMCPY_xB_A9_X
			CLRB
			LDX	#M7571
1			STAB	,X
			INCB
			INX
			CPX	#M75F1
			BNE	1B
			LDX	#S_GOOD_MORNING
			STX	M00A9
			LDAB	#$10
			LDX	#M7740
			JSR	MEMCPY_xB_A9_X
			JSR	F_9A00
			RTS

D_99C9			FCB	$08,$18,$00,$49,$00,$00,$19,$10
			FCB	$13,$18,$31,$10,$13,$15,$18,$11
			FCB	$15,$18,$31,$10,$13,$18,$31,$0F
			FCB	$14,$18,$31,$10,$13,$15,$18,$10
			FCB	$13,$15,$18,$10,$13,$18,$31,$10
			FCB	$13,$15,$18,$0F,$14,$18,$31,$10
			FCB	$13,$15,$18,$0F,$12,$14,$18

;-------

F_9A00			LDAA	M778A
			PSHA
			LDAA	M7789
			PSHA
			LDAB	#$01
			STAB	M778A
			LDAB	#$01
			STAB	M7789
			CLRA
			JSR	HI_CALL_02
			LDAB	#$03
			STAB	M7789
			CLRA
			JSR	HI_CALL_02
			PULA
			STAA	M7789
			PULA
			STAA	M778A
			JSR	HI_CALL_03
			RTS

;-------

HI_CALL_00		PSHB
			LDAB	#$00
			JMP	1F
HI_CALL_01		PSHB
			LDAB	#$01
			JMP	1F
HI_CALL_02		PSHB
			LDAB	#$02
			JMP	1F
HI_CALL_03		PSHB
			LDAB	#$03
			JMP	1F
HI_CALL_04		PSHB
			LDAB	#$04
			JMP	1F
HI_CALL_05		PSHB
			LDAB	#$05
			JMP	1F
HI_CALL_06		PSHB
			LDAB	#$06
			JMP	1F
MIDI_INIT_RX		PSHB
			LDAB	#$07
			BRA	1F
MIDI_INIT		PSHB
			LDAB	#$08
			BRA	1F
HI_CALL_09		PSHB
			LDAB	#$09
			BRA	1F
HI_CALL_0A		PSHB
			LDAB	#$0A
			BRA	1F
HI_CALL_0B		PSHB
			LDAB	#$0B
			BRA	1F
MIDI_TX		PSHB
			LDAB	#$0C
			BRA	1F
HI_CALL_0D		PSHB
			LDAB	#$0D
			BRA	1F
HI_CALL_0E		PSHB
			LDAB	#$0E
			BRA	1F
HI_CALL_0F		PSHB
			LDAB	#$0F
			BRA	1F
MIDI_SYSEX_END		PSHB
			LDAB	#$10
			BRA	1F
HI_CALL_11		PSHB
			LDAB	#$11
			BRA	1F
HI_CALL_12		PSHB
			LDAB	#$12
			BRA	1F
HI_CALL_13		PSHB
			LDAB	#$13
			BRA	1F
HI_CALL_14		PSHB
			LDAB	#$14
			BRA	1F
HI_CALL_15		PSHB
			LDAB	#$15
			BRA	1F
HI_CALL_16		PSHB
			LDAB	#$16
			BRA	1F
HI_CALL_17		PSHB
			LDAB	#$17
			BRA	1F
HI_CALL_18		PSHB
			LDAB	#$18
			BRA	1F
HI_CALL_19		PSHB
			LDAB	#$19
			BRA	1F
HI_CALL_1A		PSHB
			LDAB	#$1A
			BRA	1F
HI_CALL_1B		PSHB
			LDAB	#$1B
			BRA	1F
HI_CALL_1C		PSHB
			LDAB	#$1C
			BRA	1F
HI_CALL_1D		PSHB
			LDAB	#$1D
1			STAB	XROM
			PULB
			JSR	XROM_CALL
			RTS

;-------

F_9ACD			CLRB
1			PSHB
			LDAA	,X
			CMPB	#$30
			BNE	4F
			TIM	#$04,$00,X
			BNE	2F
			ANDA	#$FB
			ORAA	#$02
			BRA	3F
2			ORAA	#$04
			ANDA	#$FD
3			ANDA	#$0F
4			PSHX
			ANDA	#$7F
			TAB
			ADDB	MIDI_CRC
			STAB	MIDI_CRC
			JSR	MIDI_TX
			PULX
			INX
			PULB
			INCB
			CMPB	#$43
			BNE	1B
			PSHX
5			LDAA	#$63
			PSHB
			TAB
			ADDB	MIDI_CRC
			STAB	MIDI_CRC
			JSR	MIDI_TX
			PULB
			INCB
			CMPB	#$46
			BNE	5B
6			LDAA	#$32
			PSHB
			TAB
			ADDB	MIDI_CRC
			STAB	MIDI_CRC
			JSR	MIDI_TX
			PULB
			INCB
			CMPB	#$49
			BNE	6B
			PULX
7			PSHB
			LDAA	,X
			CMPB	#$4F
			BNE	8F
			ANDA	#$0F
8			PSHX
			ANDA	#$7F
			TAB
			ADDB	MIDI_CRC
			STAB	MIDI_CRC
			JSR	MIDI_TX
			PULX
			INX
			PULB
			INCB
			CMPB	#$54
			BNE	7B
9			CLRA
			PSHB
			TAB
			ADDB	MIDI_CRC
			STAB	MIDI_CRC
			JSR	MIDI_TX
			PULB
			INCB
			CMPB	#$80
			BNE	9B
			RTS

;-------

LCD_CLR_BOTTOM		LDAA	#$10
			BRA	1F

;-------	fallthrough

LCD_CLR			LDAA	#$20
1			LDX	#LCD_BUFFER + 32
2			PSHA
			LDAA	#' '
			DEX
			STAA	,X
			PULA
			DECA
			BNE	2B
			RTS

;-------

PUTSTR_OFFSET		SET	SO_32_VOICE_ - $80

			INCLUDE	"inc/lcd.asm"

;-------
;
; output a three digit decimal from A to the LCD output buffer
; - uses B
;
PUT_DIGIT_3		CLR	>M00AB
			LDAB	#100
			BSR	_PUT_DIGIT_DIV

;-------	fallthrough
;
; output a two digit decimal from A to the LCD output buffer
; - uses B
;
PUT_DIGIT_2		STAB	M00AB
			LDAB	#10
			BSR	_PUT_DIGIT_DIV

;-------	fallthrough
;
; output a single (decimal) digit from A to the LCD output buffer
; - uses B
;
PUT_DIGIT_1		ADDA	#'0'
			TAB
			BRA	3F

;-------	fallthrough (almost)
;
; Helper for above functions - performs division to find each digit
;
;     A = number to display
;     B = divisor
; M00AB = dividend
;
_PUT_DIGIT_DIV		STAB	M00AC		; save divisor
			LDAB	#'0'		; start with a quotient of zero (ASCII)
1			CMPA	M00AC		; compare A with divisor
			BCS	2F
			INCB			; increase quotient
			SUBA	M00AC		; subtract divisor from A
			BRA	1B		; and start over
2			CMPB	#'0'
			BNE	3F		; digit not-zero? output it
			TST	>M00AB
			BNE	3F
			LDAB	#' '		; replace with space

3			JSR	PUTCHAR
			SUBB	#$20
			RTS

;-------

F_9BFA			CLR	>M00AB
			CLR	>M00AC
1			SUBD	#1000
			BCS	2F
			INC	>M00AB
			BRA	1B
2			ADDD	#1000
3			SUBD	#100
			BCS	4F
			INC	>M00AC
			BRA	3B
4			ADDD	#100
			PSHB
			LDAA	M00AB
			LDAB	#10
			MUL
			ADDB	M00AC
			TBA
			LDAB	#1
			JSR	PUT_DIGIT_2
			PULA
			RTS

;-------

F_9C2A			PSHA
			PSHB
			CLR	>M00AB
1			SUBD	#10000
			BCS	2F
			INC	>M00AB
			BRA	1B
2			ADDD	#10000
			XGDX
			LDAA	M00AB
			BEQ	3F
			JSR	PUT_DIGIT_1
			BRA	4F
3			LDAB	#' '
			JSR	PUTCHAR
4			XGDX
			JSR	F_9BFA
			JSR	PUT_DIGIT_2
			PULB
			PULA
			XGDX
			CPX	#1000
			BCC	8F
			LDD	M00A7
			SUBD	#$0004
			STD	M00A7
			LDAB	#' '
			JSR	PUTCHAR
			CPX	#100
			BCC	6F
			JSR	PUTCHAR
			CPX	#FRCL
			BCC	5F
			JSR	PUTCHAR
			LDAB	#$01
			BRA	7F
5			LDAB	#$02
			BRA	7F
6			LDAB	#$03
7			LDX	M00A7
			ABX
			STX	M00A7
8			RTS

;-------

F_9C86			PSHX
			XGDX
			JSR	F_9BFA
			PULX
			CPX	#1000
			BCC	1F
			LDAB	#$20
			STAB	LCD_BUFFER + 27
1			LDAB	#'.'
			JSR	PUTCHAR
			JSR	PUT_DIGIT_2
			RTS

;-------

F_9C9F			CLR	>M00AC
1			SUBD	#100
			BCS	2F
			INC	>M00AC
			BRA	1B
2			ADDD	#100
			PSHB
			LDAA	M00AC
			JSR	PUT_DIGIT_1
			PULA
			LDAB	#'.'
			JSR	PUTCHAR
			JSR	PUT_DIGIT_2
			RTS

;-------

F_9CBF			TST	M7792
			BEQ	2F
			TST	M7793
			BNE	1F
			ADDB	#$20
			BRA	2F
1			LDAB	#$63
2			RTS

;------

F_9CD0			TST	M7791
			BEQ	1F
			ADDB	#$20
1			RTS

;------
;
; Fill @(0xA7) with B space characters
;
PUTSPACES			LDAA	#$20
			LDX	M00A7
1			STAA	,X
			INX
			STX	M00A7
			DECB
			BNE	1B
			RTS

;-------

LO_CALL_0C		TST	>M0056
			BNE	3F
			JSR	LCD_CLR
			STX	M00A7
			LDAB	#$0C
			JSR	LCD_WAIT
			STAB	LCD_CMD
			TST	>M009A
			BEQ	1F
			JMP	C_9E9E
1			LDAB	M7772
			CMPB	#$17
			BCS	2F
			CLRB
2			JSR	JMPOFFB
			FCB	6F - *			; 0
			FCB	4F - *
			FCB	5F - *
			FCB	3F - *
			FCB	8F - *			; 4
			FCB	C_9D49 - *
			FCB	C_9D67 - *
			FCB	3F - *
			FCB	3F - *			; 8
			FCB	7F - *
			FCB	C_9DDD - *
			FCB	3F - *
			FCB	3F - *			; 12
			FCB	3F - *
			FCB	C_9D94 - *
			FCB	3F - *
			FCB	3F - *			; 16
			FCB	7F - *
			FCB	C_9E16 - *
			FCB	3F - *
			FCB	3F - *			; 20
			FCB	3F - *
			FCB	C_9DD0 - *

3			RTS				; case 3, 7, 8, 11, 12, 13,
							;      15, 16, 19, 20, 21

4			JMP	C_9EEC			; case 1
5			JMP	C_9EC0			; case 2
6			JMP	C_9E61			; case 0
7			JMP	C_9E2F			; case 9, 17
8			JSR	F_B1CE			; case 4
			LDAB	#$02
			STAB	M7787
			TST	>M00A5
			BEQ	9F
			LDX	#LCD_BUFFER + 16
			STX	M00A7
			LDX	#S_ARE_YOU_SURE
			JMP	LCD_WRITE
9			JMP	32F

C_9D49			JSR	F_B163			; case 5
			LDX	#LCD_BUFFER + 16
			STX	M00A7
			LDAB	M7774
			CMPB	#$35
			BNE	11F
			LDX	#S_NAME
			JSR	PUTSTRX
			JSR	F_AFC9
			JMP	LCD_UPDATE
11			JMP	33F

C_9D67			TST	M7795			; case 6
			BPL	C_9D94
			LDAB	#'P'
			JSR	F_9CD0
			JSR	PUTCHAR
			LDAA	M7779
			JSR	F_AF7D
			LDX	#LCD_BUFFER + 5
			STX	M00A7
			JSR	F_AFC9
			LDX	#LCD_BUFFER + 16
			STX	M00A7
			LDAB	#$2A
			STAB	M7774
			LDAB	#$02
			STAB	M7787
			JMP	C_9F54

C_9D94			LDAB	#'P'			; case 14
			JSR	F_9CD0
			JSR	PUTCHAR
			LDX	#S_ERFORMANCE_MODE
			JSR	PUTSTRX
			LDX	#LCD_BUFFER + 16
			STX	M00A7
			LDX	#S_PFM_STORE
			JSR	PUTSTRX
			LDAA	M777A
			LDX	#LCD_BUFFER + 26
			STX	M00A7
			INCA
			CLRB
			JSR	PUT_DIGIT_2
			LDAB	#CH_RIGHT
			JSR	PUTCHAR
			LDAA	M7795
			BMI	14F
			LDX	#LCD_BUFFER + 29
			STX	M00A7
			INCA
			CLRB
			JSR	PUT_DIGIT_2
14			BRA	16F

C_9DD0			LDAB	#'P'			; case 22
			JSR	F_9CD0
			JSR	PUTCHAR
			LDX	#S_ERFORMANCE_MODE
			BRA	18F

C_9DDD			LDAB	#'P'			; case 10
			JSR	F_9CBF
			JSR	PUTCHAR
			LDX	#S_LAY_SINGLE
			JSR	PUTSTRX
			LDX	#LCD_BUFFER + 16
			STX	M00A7
			LDX	#S_MEM_STR
			JSR	PUTSTRX
			LDAA	M777F
			LDX	#LCD_BUFFER + 24
			STX	M00A7
			JSR	F_AF7D
			LDAB	#CH_RIGHT
			JSR	PUTCHAR
			LDAA	M7795
			BMI	16F
			LDX	#LCD_BUFFER + 28
			STX	M00A7
			JSR	F_AF7D
16			JMP	LCD_UPDATE

C_9E16			LDAB	#'P'			; case 18
			JSR	F_9CBF
			JSR	PUTCHAR
			LDX	#S_LAY_SINGLE
18			JSR	PUTSTRX
			LDX	#LCD_BUFFER + 16
			STX	M00A7
			LDX	#S_MEM_PROTECTED
			JMP	LCD_WRITE

C_9E2F			JSR	F_AFB0
			LDX	#LCD_BUFFER + 16
			STX	M00A7
			LDX	#S_EG_COPY_OP_OP
			JSR	PUTSTRX
			LDX	#LCD_BUFFER + 26
			STX	M00A7
			LDAA	M777C
			ANDA	#$03
			INCA
			JSR	PUT_DIGIT_1
			LDAB	#CH_RIGHT
			JSR	PUTCHAR
			LDAA	M7794
			BMI	20F
			LDX	#LCD_BUFFER + 30
			STX	M00A7
			INCA
			JSR	PUT_DIGIT_1
20			JMP	LCD_UPDATE

C_9E61			LDAB	M7774
			CMPB	#$14
			BCC	22F
			LDAB	#$01
			STAB	M7772
			JMP	4B
22			JSR	F_B07A
			LDX	#LCD_BUFFER + 16
			STX	M00A7
			LDAB	M7774
			CMPB	#$1F
			BNE	24F
			LDX	#M7740
23			LDAB	,X
			JSR	PUTCHAR
			INX
			CPX	#M7750
			BNE	23B
			JMP	LCD_UPDATE

24			TST	>M00A5
			BEQ	25F
			LDX	#S_ARE_YOU_SURE
			JMP	LCD_WRITE
25			JMP	33F

C_9E9E			LDX	#LCD_BUFFER + 1
			STX	M00A7
			LDX	#S_MASTER_VOLUME
			JSR	PUTSTRX
			JSR	F_B3B5
			LDX	#LCD_BUFFER + 30
			STX	M00A7
			LDAA	M776D
			COMA
			LSRA
			JSR	F_B4D6
			CLRB
			JSR	PUT_DIGIT_2
			JMP	LCD_UPDATE

C_9EC0			TST	M7795
			BMI	28F
			JMP	C_9DDD
28			LDAB	#'P'
			JSR	F_9CBF
			JSR	PUTCHAR
			LDX	#S_LAY_SINGLE
			JSR	PUTSTRX
			LDX	#LCD_BUFFER + 16
			STX	M00A7
			LDAA	M7773
			JSR	F_AF7D
			LDX	#LCD_BUFFER + 21
			STX	M00A7
			JSR	F_AFD8
			JMP	LCD_UPDATE
C_9EEC			LDAB	M7774
			CMPB	#$0B
			BCS	30F
			CLR	M7772
			JMP	C_9E61
30			TST	M7794
			BMI	31F
			JMP	C_9E2F

31			JSR	F_AFB0
			JSR	F_AFED
32			LDX	#LCD_BUFFER + 16
			STX	M00A7
33			LDAB	M7788
			CMPB	#$01
			BEQ	C_9F75
			CMPB	#$02
			BCS	C_9F1A
			JMP	C_9FAC

C_9F1A			LDAB	M7774

			JSR	JMPOFF1
			FCB	C_A005 - *
			FCB	$0B
			FCB	1F - *
			FCB	$14
			FCB	C_9F43 - *
			FCB	$1F
			FCB	1F - *
			FCB	$28
			FCB	C_9F47 - *
			FCB	$29
			FCB	C_9F54 - *
			FCB	$30
			FCB	C_9F60 - *
			FCB	$31
			FCB	C_9F54 - *
			FCB	$33
			FCB	C_9F4B - *
			FCB	$34
			FCB	C_9F64 - * 
			FCB	$35
			FCB	1F - *
			FCB	$3C
			FCB	C_9F54 - *
			FCB	$3D
			FCB	C_9F6C - *
			FCB	$3E
			FCB	C_9F68 - *
			FCB	$3F
			FCB	1F - *
			FCB	$46
			FCB	C_9F70 - *
			FCB	$47
			FCB	1F - *
			FCB	$00

1			RTS

C_9F43			SUBB	#$09
			BRA	13F

C_9F47			LDAB	#$16
			BRA	13F

C_9F4B			LDAB	#$17
			LDAA	M778C
			CMPA	#$06
			BRA	6F

C_9F54			LDAB	#$17
			LDAA	M778C
			CMPA	#$04
6			BCS	7F
			INCB
7			BRA	13F

C_9F60			LDAB	#$19
			BRA	13F

C_9F64			LDAB	#$1A
			BRA	13F

C_9F68			LDAB	#$0D
			BRA	13F

C_9F6C			LDAB	#$1B
			BRA	13F

C_9F70			LDAB	#$1C

13			JMP	C_A005

C_9F75			LDAB	M7774
			LDAA	M7789
			CMPA	M778D
			BLS	1F
			CLRA
			STAA	M7789

1			JSR	JMPOFF1
			FCB	2F - *
			FCB	$02
			FCB	C_9FF9 - *
			FCB	$03
			FCB	C_9FCB - *
			FCB	$04
			FCB	C_9FCF - *
			FCB	$05
			FCB	2F - *
			FCB	$07
			FCB	C_9FD7 - *
			FCB	$08
			FCB	2F - *
			FCB	$09
			FCB	C_9FDB - *
			FCB	$0A
			FCB	C_9FDF - *
			FCB	$0B
			FCB	2F - *
			FCB	$15
			FCB	C_9FE3 - *
			FCB	$16
			FCB	2F - *
			FCB	$18
			FCB	C_9FE7 - *
			FCB	$19
			FCB	C_9FEB - *
			FCB	$1A
			FCB	C_9FEF - *
			FCB	$1B
			FCB	C_9FF3 - *
			FCB	$1C
			FCB	C_9FF7 - *
			FCB	$1D
			FCB	2F - *
			FCB	$00

2			RTS

C_9FAC			LDAA	M7774
			CMPA	#$15
			BNE	3F
			LDAA	M7789
			CMPA	#$0C
			BNE	2B
			JMP	C_A13A
3			CMPA	#$1B
			BNE	4F
			JMP	C_A098
4			CMPA	#$1C
			BNE	2B
			JMP	C_A017

C_9FCB			ADDA	#$06
			BRA	C_9FF9

C_9FCF			SUBA	#$03
			BPL	C_9FCF
			ADDA	#$0D
			BRA	C_9FF9

C_9FD7			ADDA	#$0D
			BRA	C_9FF9

C_9FDB			ADDA	#$13
			BRA	C_9FF9

C_9FDF			ADDA	#$15
			BRA	C_9FF9

C_9FE3			ADDA	#$25
			BRA	C_9FF9

C_9FE7			ADDA	#$32
			BRA	C_9FF9

C_9FEB			ADDA	#$3D
			BRA	C_9FF9

C_9FEF			ADDA	#$41
			BRA	C_9FF9

C_9FF3			LDAA	#$44
			BRA	C_9FF9

C_9FF7			ADDA	#$45

C_9FF9			TAB
			CMPB	#$49
			BCS	1F
			CLRB
1			ASLB
			LDX	#DVEC_STRINGS_2
			BRA	4F

C_A005			CMPB	#$1D
			BCS	3F
			CLRB
3			ASLB
			LDX	#DVEC_STRINGS
4			ABX
			LDX	,X
			JSR	PUTSTRX
			JMP	C_A174

C_A017			LDAB	M7789
			BEQ	6F
			CMPB	#$02
			BEQ	7F
			JMP	C_A0D5
6			LDAB	M778A
			ADDB	#$3C
			JSR	F_B43F
			LDX	M00A7
			INX
			INX
			INX
			STX	M00A7
			LDAB	#':'
			JSR	PUTCHAR
			LDX	#M7628
			BRA	8F
7			LDAB	M778A
			JSR	F_B43F
			LDX	M00A7
			INX
			INX
			INX
			STX	M00A7
			LDAB	#':'
			JSR	PUTCHAR
			LDX	#M7640
8			LDAB	M778A
			ASLB
			ABX
			LDAB	$01,X
			CMPB	#$21
			BCS	9F
			LDAB	,X
			INCB
			BRA	10F
9			LDAB	,X
10			PSHX
			JSR	F_B43F
			LDX	M00A7
			INX
			INX
			INX
			INX
			STX	M00A7
			PULX
			LDAA	$01,X
			PSHX
			CMPA	#$21
			BCS	11F
			COMA
			SUBA	#$BF
			LDAB	#'-'
			JSR	PUTCHAR
			BRA	12F
11			LDAB	#'+'
			JSR	PUTCHAR
12			CLRB
			JSR	PUT_DIGIT_2
			PULX
			LDD	,X
			SUBA	#$0D
			ASLB
			ASLB
			LSRD
			LSRD
			JSR	F_9C2A
			BRA	16F

C_A098			CLRB
13			PSHB
			LDAB	#$04
			LDAA	M7789
			MUL
			PULA
			PSHA
			ABA
			TAB
			LDX	#M75F8
			ABX
			LDAB	,X
			CMPB	#$31
			BCC	14F
			ADDB	M7789
			ADDB	#$24
			JSR	F_B43F
			LDX	M00A7
			INX
			INX
			INX
			STX	M00A7
			BRA	15F
14			JSR	F_A5F0
15			PULB
			CMPB	#$03
			BEQ	16F
			PSHB
			LDAB	#'/'
			JSR	PUTCHAR
			PULB
			INCB
			BRA	13B
16			CLRB
			JMP	C_A174

C_A0D5			LDAA	M778A
			INCA
			CMPA	#$0A
			BCS	1F
			JSR	PUT_DIGIT_2
			BRA	2F
1			JSR	PUT_DIGIT_1
2			LDAB	#':'
			JSR	PUTCHAR
			LDAB	M778A
			ASLB
			LDX	#DVEC_SCALE_NAMES
			ABX
			LDX	,X
			JSR	PUTSTRX
			TSTB
			BEQ	7F
			LDAB	M778F
			CMPB	#$0C
			BCS	3F
			CLRB
3			LDAA	M778A
			CMPA	#$02
			BNE	5F
			ADDB	#$09
			CMPB	#$0C
			BCS	4F
			SUBB	#$0C
4			ASLB
			LDX	#S_SHARPS
			BRA	6F
5			ASLB
			LDX	#S_FLATS
6			ABX
			LDD	,X
			STD	LCD_BUFFER + 30
7			CLRB
			BRA	C_A174

DVEC_SCALE_NAMES	FDB     S_EQUAL
			FDB     S_PURE_MAJOR
			FDB     S_PURE_MINOR
			FDB     S_MEAN_TONE
			FDB     S_PYTHAGOREAN
			FDB     S_WERCKMEISTER
			FDB     S_KIRNBERGER
			FDB     S_VALLOTTI_YOUNG
			FDB     S_1_4_SHIFT_EQUAL
			FDB     S_1_4_TONE
			FDB     S_1_8_TONE

C_A13A			LDX	#S__PGM
			JSR	PUTSTRX
			LDAA	M778A
			INCA
			CLRB
			JSR	PUT_DIGIT_3
			LDX	#S__EQUALS__
			JSR	PUTSTRX
			LDX	M7781
			LDAA	,X
			CMPA	#$A0
			BCC	1F
			JSR	F_AF7D
			BRA	3F
1			CMPA	#$B8
			BCS	2F
			LDAA	#$A0
2			LDAB	#'P'
			JSR	PUTCHAR
			LDAB	#'F'
			JSR	PUTCHAR
			SUBA	#$9F
			LDAB	#$01
			JSR	PUT_DIGIT_2
3			CLRB

;-------	fallthrough

C_A174			CMPB	#$20
			BCS	1F
			CLRB
1			LDX	#CVEC_A182
			ASLB
			ABX
			LDX	,X
			JMP	,X

CVEC_A182		FDB     LCD_UPDATE
			FDB     F_A1CD
			FDB     F_A1D6
			FDB     F_A1E0
			FDB     F_A2AC
			FDB     F_A370
			FDB     F_A37E
			FDB     F_A3B0
			FDB     F_A3BF
			FDB     F_A3D2
			FDB     F_A3E4
			FDB     F_A424
			FDB     F_A386
			FDB     F_A390
			FDB     F_A3A5
			FDB     F_A452
			FDB     F_A42E
			FDB     F_A485
			FDB     F_A494
			FDB     F_A4DE
			FDB     F_A4DA
			FDB     F_A600
			FDB     F_A66E
			FDB     F_A67D
			FDB     F_A699
			FDB     F_A6AE
			FDB     F_A6CA
			FDB     F_A6D4
			FDB     F_A6E4
			FDB     F_A705
			FDB     F_A74A
			FDB     F_A75A

;-------

F_A1C2			LDAB	#'='
F_A1C4			JSR	PUTCHAR
F_A1C7			LDX	M7781
			LDAA	,X
			RTS

;-------

F_A1CD			BSR	F_A1C2
			CLRB
			JSR	PUT_DIGIT_2
			JMP	LCD_UPDATE

;-------

F_A1D6			LDAB	#':'
			BSR	F_A1C4
			JSR	F_B432
			JMP	LCD_UPDATE

;-------

F_A1E0			LDAB	M777B
			LDAA	#$05
			JSR	F_B533
			TST	$57,X
			BEQ	1F
			JMP	13F
1			PSHX
			LDX	#S_RATIO
			JSR	PUTSTRX
			LDAB	#'='
			JSR	PUTCHAR
			JSR	F_B52E
			LDAB	$0B,X
			LDX	#D_B4EA
			ABX
			LDAB	,X
			TBA
			ANDB	#$03
			LDX	#D_A2A8
			ABX
			LDAB	,X
			PULX
			ANDA	#$3C
			BNE	2F
			LDAA	#$08
			BRA	3F
2			ASLA
			ASLA
3			ADDA	$59,X
			CMPB	#$8D
			BNE	8F
			TST	$59,X
			BNE	8F
			CMPA	#$30
			BCS	8F
			CMPA	#$50
			BCS	4F
			CMPA	#$90
			BCS	5F
			BEQ	6F
			CMPA	#$B0
			BCS	8F
			CMPA	#$F0
			BCS	7F
			MUL
			ADDD	#$0050
			BRA	9F
4			MUL
			ADDD	#$0010
			BRA	9F
5			MUL
			ADDD	#$0020
			BRA	9F
6			MUL
			ADDD	#$0030
			BRA	9F
7			MUL
			ADDD	#$0040
			BRA	9F
8			MUL
9			LSRD
			LSRD
			LSRD
			LSRD
			XGDX
			CPX	#$0046
			BEQ	10F
			CPX	#$0056
			BNE	11F
10			INX
11			JSR	F_9C86
12			JMP	LCD_UPDATE
13			PSHX
			LDX	#S_FIX
			JSR	PUTSTRX
			LDAB	#'='
			JSR	PUTCHAR
			JSR	F_B52E
			LDAB	$0B,X
			ANDB	#$3C
			BNE	14F
			LDAB	#$08
			BRA	15F
14			ASLB
			ASLB
15			PULX
			ADDB	$59,X
			PSHB
			CLRA
			LDAB	$58,X
			XGDX
			PULB
			CLRA
			CPX	#$0000
			BEQ	17F
16			ASLD
			DEX
			BNE	16B
17			JSR	F_9C2A
			LDD	#$487A			; 'Hz'
			STD	LCD_BUFFER + 30
			BRA	12B

D_A2A8			FCB	$64,$8D,$9D,$AD

;-------

F_A2AC			LDAB	M7774
			CMPB	#$05
			BNE	1F
			LDX	#LCD_BUFFER + 4
			BRA	2F
1			LDX	#LCD_BUFFER + 20
2			STX	M00A7
			JSR	SET_CGCHAR_SET
			CLRB
3			PSHB
			LDX	#D_B52A
			ABX
			LDAB	,X
			LDAA	M7787
			CMPA	#$57
			BCC	4F
			LDAA	#$0D
			BRA	5F
4			LDAA	#$05
5			MUL
			ADDB	M7787
			LDX	M7784
			ABX
			LDAA	,X
			LDAB	M7787
			CMPB	#$5B
			BNE	8F
			TSTA
			BNE	6F
			LDX	#S__OF
			JSR	PUTSTRX
			BRA	11F
6			COMA
			SUBA	#$FB
			LDAB	#$06
7			ASLB
			DECA
			BNE	7B
			TBA
			BRA	10F
8			CMPB	#$0C
			BNE	9F
			BSR	F_A351
			BRA	11F
9			CMPB	#$5A
			BNE	10F
			PSHA
			TAB
			ASLB
			LDX	#D_A341
			ABX
			LDD	,X
			LDX	M00A7
			INX
			STX	M00A7
			JSR	PUTCHAR
			TAB
			JSR	PUTCHAR
			PULA
			LDX	M00A7
			PSHX
			LDAB	#$0E
			ABX
			STX	M00A7
			LDAB	#'W'
			JSR	PUTCHAR
			INCA
			JSR	PUT_DIGIT_1
			PULX
			STX	M00A7
			BRA	11F
10			JSR	PUT_DIGIT_3
11			PULB
			INCB
			CMPB	#$04
			BNE	3B
			JMP	LCD_UPDATE

D_A341			FCB	$01,$00,$03,$02,$2D,$00,$2D,$02
			FCB	$2D,$04,$2D,$05,$2D,$06,$2D,$07

;-------

F_A351			LDAB	#' '
			JSR	PUTCHAR
			SUBA	#$03
			BHI	1F
			BMI	2F
			CLRB
			JSR	PUT_DIGIT_2
			BRA	4F
1			LDAB	#'+'
			BRA	3F
2			NEGA
			LDAB	#'-'
3			JSR	PUTCHAR
			JSR	PUT_DIGIT_1
4			RTS

;-------

F_A370			JSR	F_A1C2
			LDAB	M6AA5
			ADDB	#$24
			JSR	F_B43F
1			JMP	LCD_UPDATE

;-------

F_A37E			JSR	F_A1C2
			JSR	F_B463
			BRA	1B

;-------

F_A386			JSR	F_A1C2
			SUBA	#$18
			JSR	F_B465
			BRA	1B

;-------

F_A390			LDAB	#$3A
			JSR	F_A1C4
			TAB
			ASLB
			LDX	#DVEC_A39F
			ABX
			LDX	,X
			BRA	1000F

DVEC_A39F		FDB	S_NOTE_ALL
			FDB	S_NOTE_ODD
			FDB	S_NOTE_EVEN

;-------

F_A3A5			LDX	#LCD_BUFFER + 22
			STX	M00A7
			JSR	F_AFD8
			JMP	LCD_UPDATE

;-------

F_A3B0			JSR	F_A1C7
			LDX	#S_MONO_MODE
			TSTA
			BNE	1000F
			LDX	#S_POLY_MODE
1000			JMP	LCD_WRITE

;-------

F_A3BF			TST	M6AA6
			BEQ	1F
			JSR	F_A1C7
			LDX	#S_FINGERED_PORTA
			TSTA
			BNE	1000B
1			LDX	#S_FULL_TIME_PORTA
			BRA	1000B

;-------

F_A3D2			JSR	F_A1C2
			CMPA	#$04
			BCS	1F
			CLRA
1			LDX	#DVEC_LFO_MODE
			TAB
			ASLB
			ABX
			LDX	,X
			BRA	1000B

;-------

F_A3E4			LDAB	#'='
			JSR	PUTCHAR
			LDX	#LCD_BUFFER + 20
			STX	M00A7
			CLRB
1			PSHB
			LDX	#D_B52A
			ABX
			LDAB	,X
			LDAA	#$0D
			MUL
			ADDB	#$08
			LDX	M7784
			ABX
			TST	,X
			BNE	2F
			LDX	#S__OF
			BRA	3F
2			LDX	#S__ON
3			JSR	PUTSTRX
			PULB
			INCB
			CMPB	#$04
			BNE	1B
			LDX	M7784
			LDAA	$3D,X
			LDX	#LCD_BUFFER + 20
			STX	M00A7
			JSR	PUT_DIGIT_1
1000			JMP	LCD_UPDATE

;--------

F_A424			JSR	F_A1C2

1001			INCA
			CLRB
			JSR	PUT_DIGIT_2
			BRA	1000B

;-------

F_A42E			LDAB	#'='
			JSR	PUTCHAR
			JSR	F_B53E
			LDAB	M7774
			CMPB	#$03
			BNE	1F
			LDAA	$3C,X
			CLRB
			JSR	PUT_DIGIT_2
			BRA	1000B
1			LDAA	$34,X
			PSHA
			INCA
			JSR	PUT_DIGIT_1
			PULA
			JSR	F_B22C
			BRA	1000B

;-------

F_A452			LDAB	M7774
			CMPB	#$15
			BNE	3F
			LDX	#LCD_BUFFER + 29
			STX	M00A7
			LDAB	M777E
			BNE	1F
			LDAB	#$49
			BRA	2F
1			DECB
			ADDB	#'A'
2			JSR	PUTCHAR
			JMP	LCD_UPDATE
3			LDX	#LCD_BUFFER + 28
			STX	M00A7
			TST	M777E
			BNE	4F
			LDX	#S_TX
			BRA	1002F
4			LDX	#S_DX
1002			JMP	LCD_WRITE

;-------

F_A485			JSR	F_A1C2
			CMPA	#$10
			BEQ	1F
			JMP	1001B
1			LDX	#S_OMN
			BRA	1002B

;-------

F_A494			LDAB	#'='
			JSR	PUTCHAR
			LDAB	M777B
			LDAA	#$05
			JSR	F_B533
			LDAA	$58,X
			CMPA	#$01
			BHI	3F
			BEQ	1F
			LDAA	#$FF
			JSR	PUT_DIGIT_3
			BRA	2F
1			LDD	#$3531			; '51'
			STD	LCD_BUFFER + 27
			LDAB	#'0'
			STAB	LCD_BUFFER + 29
2			LDD	#$487A			; 'Hz'
			STD	LCD_BUFFER + 30
			JMP	LCD_UPDATE
3			SUBA	#$01
			LDAB	#$01
4			DECA
			BEQ	5F
			ASLB
			BRA	4B
5			TBA
			CLRB
			JSR	PUT_DIGIT_2
			LDAB	#'K'
			JSR	PUTCHAR
			BRA	2B

;-------

F_A4DA			LDAB	#$30
			BRA	1F

;-------	fallthrough

F_A4DE			CLRB
1			LDAA	M7787
			CMPA	#$60
			BEQ	2F
			CMPA	#$63
			BNE	3F
2			LDAA	#$0B
3			LDX	#LCD_BUFFER + 16
			TSTB
			BEQ	4F
			INX
4			STX	M00A7
			LDX	#M6DD7
			ABX
			TAB
			LDAA	#$04
5			PSHA
			PSHB
			PSHX
			TSTB
			BEQ	6F
			TST	,X
			BNE	6F
			JMP	31F
6			ABX
			LDAA	,X
			LDAB	M7774

			JSR	JMPOFF1
			FCB	7F - *
			FCB	$29
			FCB	C_A532 - *
			FCB	$2A
			FCB	C_A538 - *
			FCB	$2B
			FCB	C_A53E - *
			FCB	$2C
			FCB	C_A555 - *
			FCB	$2E
			FCB	C_A562 - *
			FCB	$2F
			FCB	C_A54E - *
			FCB	$30
			FCB	7F - *
			FCB	$31
			FCB	C_A569 - *
			FCB	$32
			FCB	C_A599 - *
			FCB	$33
			FCB	C_A5C3 - *
			FCB	$34
			FCB	7F - *
			FCB	$3C
			FCB	C_A538 - *
			FCB	$3D
			FCB	7F - *
			FCB	$00

7			PULX
			PULB
			PULA
			RTS

C_A532			JSR	PUT_DIGIT_3
			JMP	29F
C_A538			JSR	F_AF91
			JMP	29F
C_A53E			CMPA	#$10
			BNE	11F
			LDX	#S_OMN
			JSR	PUTSTRX
			JMP	29F
11			INCA
			BRA	C_A532

C_A54E			SUBA	#$18
			JSR	F_B465
			BRA	29F
C_A555			TAB
			JSR	F_B43F
			LDD	M00A7
			ADDD	#$03
			STD	M00A7
			BRA	29F
C_A562			SUBA	#$07
			JSR	F_B465
			BRA	29F
C_A569			PSHA
			JSR	F_B37F
			PULB
			TSTB
			BEQ	21F
			CMPB	#$01
			BNE	16F
			LDAB	#$02
			JSR	PUTSPACES
			LDAB	#'I'
			BRA	19F
16			CMPB	#$02
			BNE	17F
			LDAB	#$02
			JSR	PUTSPACES
			BRA	18F
17			LDAB	#$01
			JSR	PUTSPACES
			LDAB	#'I'
			JSR	PUTCHAR
18			CLRB
19			JSR	PUTCHAR
			BRA	29F
C_A599			TSTA
			BNE	22F
21			LDX	#S_OFF
			BRA	26F
22			CMPA	#$03
			BCC	25F
			CMPA	#$01
			BNE	23F
			LDAA	M784E
			BMI	32F
			BRA	24F
23			LDAA	M784F
			BMI	32F
24			INCA
			JSR	PUT_DIGIT_3
			BRA	29F
25			LDX	#S_VIB
26			JSR	PUTSTRX
			BRA	29F

C_A5C3			TSTA
			BEQ	28F
			LDX	M00A7
			INX
			STX	M00A7
28			JSR	F_B432
29			LDX	M00A7
			INX
			STX	M00A7
			PULX
			LDAB	#$0C
			ABX
			PULB
			PULA
			DECA
			BEQ	30F
			JMP	5B
30			JMP	LCD_UPDATE
31			BSR	F_A5F0
			BRA	29B
32			LDX	#S_DASHDASHDASH
			JMP	26B

S_DASHDASHDASH		FCC	"---"
			FCB	$00

;-------

F_A5F0			LDAB	#1
			JSR	PUTSPACES
			LDAB	#'*'
			JSR	PUTCHAR
			LDAB	#1
			JSR	PUTSPACES
			RTS

;-------

F_A600			TST	>M00A3
			BNE	1F
			JSR	F_B408
1			LDAB	M778C
			CMPB	#$04
			BCC	2F
			LDAB	#$7E
			STAB	LCD_BUFFER + 31
			LDX	#M6DD7
			BRA	3F
2			LDAB	#$7F
			JSR	PUTCHAR
			LDX	#M6E07
3			LDAB	#$04
4			PSHB
			PSHX
			TST	,X
			BNE	5F
			BSR	F_A5F0
			BRA	10F
5			LDAA	$08,X
			CLRB
			JSR	PUT_DIGIT_2
			PULX
			LDAA	$08,X
			PSHX
			JSR	F_B4DE
			CMPA	#$08
			BCC	7F
			TSTA
			BNE	6F
			LDX	M00A7
			INX
			STX	M00A7
			BRA	10F
6			DECA
			TAB
			BRA	9F
7			CMPA	#$0F
			BCS	8F
			LDAA	#$0E
8			SUBA	#$08
			TAB
			LDX	M00A7
			XGDX
			SUBD	#RMCR
			XGDX
			STAB	,X
			LDAB	#$06
9			JSR	PUTCHAR
10			PULX
			LDAB	#$0C
			ABX
			PULB
			DECB
			BNE	4B
			JMP	LCD_UPDATE

;-------

F_A66E			JSR	F_A1C2
			LDX	#S_NORM
			TSTA
			BEQ	1F
			LDX	#S_ALTR
1			JMP	LCD_WRITE

;-------

F_A67D			JSR	F_A1C2
			TAB
			CMPB	#$04
			BCS	1F
			LDAB	#$03
1			ASLB
			LDX	#DVEC_FX_TYPE
			ABX
			LDX	,X
			JMP	LCD_WRITE

DVEC_FX_TYPE		FDB	S_OFF
			FDB	S_FX_DELAY
			FDB	S_FX_PAN
			FDB	S_FX_CHORD

;-------

F_A699			JSR	F_A1C2
			TSTA
			BNE	1F
			LDX	#S_OFF
			JSR	PUTSTRX
			BRA	1000F
1			CLRB
			JSR	PUT_DIGIT_2
1000			JMP	LCD_UPDATE

;-------

F_A6AE			JSR	F_A1C2
			TAB
			ASLB
			LDX	#DVEC_A6BC
			ABX
			LDX	,X
			JMP	LCD_WRITE

DVEC_A6BC		FDB	S_OFF
			FDB	S_COM
			FDB	S_IND

S_COM			FCC	"com"
			FCB	$00

S_IND			FCC	"ind"
			FCB	$00

;-------

F_A6CA			JSR	F_A1C2
			SUBA	#$32
			JSR	F_B465
			BRA	1000B

;-------

F_A6D4			JSR	F_A1C2
			TAB
			INCB
			CLRA
			JSR	F_9C9F
			LDAB	#'s'
			JSR	PUTCHAR
			BRA	1000B

;-------

F_A6E4			JSR	F_A1C2
			CMPA	#$02
			BCC	3F
			TSTA
			BNE	1F
			LDX	#S_OFF
			BRA	2F
1			LDX	#S_NORM
2			JMP	LCD_WRITE
3			DECA
			LDAB	#'G'
			JSR	PUTCHAR
			CLRB
			JSR	PUT_DIGIT_2
			BRA	1000B

;-------

F_A705			TST	M7789
			BNE	1F
			JSR	F_A1C2
			TAB
			ASLB
			LDX	#DVEC_PAN_SOURCE
			ABX
			LDX	,X
			JMP	LCD_WRITE
1			JSR	F_B37F
			LDAB	#':'
			JSR	F_A1C4
			TSTA
			BNE	2F
			LDAB	#'I'
			JSR	PUTCHAR
			LDAB	#CH_RIGHT
			JSR	PUTCHAR
			CLRB
			JSR	PUTCHAR
			BRA	3F
2			CLRB
			JSR	PUTCHAR
			LDAB	#$7E
			JSR	PUTCHAR
			LDAB	#'I'
			JSR	PUTCHAR
3			JMP	LCD_UPDATE

DVEC_PAN_SOURCE		FDB	S_PAN_LFO
			FDB	S_PAN_VELOCITY
			FDB	S_PAN_NOTE

;--------

F_A74A			LDX	#LCD_BUFFER + 29
			STX	M00A7
			LDAB	M7789
			ADDB	#$3C
			JSR	F_B43F
			JMP	LCD_UPDATE

;--------

F_A75A			LDX	#LCD_BUFFER + 28
			STX	M00A7
			LDX	#DVEC_A76C
			LDAB	M777E
			ASLB
			ABX
			LDX	,X
			JMP	LCD_WRITE

DVEC_A76C		FDB	S_AL_3
			FDB	S_SY_3
			FDB	S_PC_3
			FDB	S_EF_3
			FDB	S_MC_3

;-------

DVEC_LFO_MODE		FDB	S_SAW_UP
			FDB	S_SQUARE
			FDB	S_TRIANGL
			FDB	S_S_HOLD

DVEC_STRINGS		FDB	S_ALG
			FDB	S_FEEDBACK_OP4
			FDB	S_EDIT_LFO
			FDB	S_SENSITIVITY
			FDB	S_EDIT_FREQUENCY
			FDB	S_OSW
			FDB	S_DET
			FDB	S_EDIT_EG
			FDB	S_OUT
			FDB	S_SCALING
			FDB	S___FUNCTION
			FDB	S_MASTER_TUNE
			FDB	S_MIDI_CONTROL_
			FDB	S_MEM_PROTECT
			FDB	S_COMBINE
			FDB	S_CASS_CONTROL_
			FDB	S_EDIT_EFFECT_1_
			FDB	S_EDIT_EFFECT_2_
			FDB	S_EDIT_EFFECT_3_
			FDB	S_MICRO_TUNE_
			FDB	S_INIT_VOICE_1
			FDB	S_RECALL_EDIT_1
			FDB	S_ASSIGN_MODE
			FDB	S_SLASH_SLASH_RIGHT
			FDB	S_LEFT_SLASH_SLASH
			FDB	S_VOL
			FDB	S_EFFECT_SEL
			FDB	S_INIT_PERFRM_
			FDB	S_TEST_ENTRY

DVEC_STRINGS_2		FDB	S_WAVE
			FDB	S_SPEED
			FDB	S_DELAY
			FDB	S_P_MOD_DEPTH
			FDB	S_A_MOD_DEPTH
			FDB	S_SYNC
			FDB	S_P_MOD_SENS
			FDB	S_AMS
			FDB	S_EBS
			FDB	S_KVS
			FDB	S_FIX_RANGE
			FDB	S_CRS
			FDB	S_FIN
			FDB	S_AR
			FDB	S_D1R
			FDB	S_D1L
			FDB	S_D2R
			FDB	S_RR
			FDB	S_SHFT
			FDB	S_RS
			FDB	S_LS
			FDB	S_CH7
			FDB	S_P_BEND_RANGE
			FDB	S_CH8
			FDB	S_PORTA_TIME
			FDB	S_FC_VOLUME
			FDB	S_FC_PITCH
			FDB	S_FC_AMPLITUDE
			FDB	S_MW_PITCH
			FDB	S_MW_AMPLITUDE
			FDB	S_BC_PITCH
			FDB	S_BC_AMPLITUDE
			FDB	S_BC_P_BIAS
			FDB	S_BC_EG_BIAS
			FDB	S_MIDDLE_C
			FDB	S_REVERB_RATE
			FDB	S_NAME
			FDB	S_BASIC_RECV_CH
			FDB	S_TRANSMIT_CH
			FDB	S_P_CHANGE
			FDB	S_CONT_CHANGE
			FDB	S_ATOUCH_BC
			FDB	S_PITCHBEND
			FDB	S_NOTE_ON_OFF
			FDB	S_EXCLUSIVE
			FDB	S_VOICE_TRANS
			FDB	S_PERFRM_TRANSMIT
			FDB	S_SETUP_TRANS
			FDB	S_INIT_P_CNG_TABLE
			FDB	S_EDIT_P_CNG_TABLE
			FDB	S_SAVE_32_VOICE
			FDB	S_VERIFY_2
			FDB	S_LOAD_32_VOICE
			FDB	S_LOAD_1_VOICE
			FDB	S_SAVE_24_PERFRM
			FDB	S_VERIFY_24_PERFRM
			FDB	S_LOAD_24_PERFRM
			FDB	S_LOAD_1_PERFRM
			FDB	S_SAVE_SETUP
			FDB	S_VERIFY_SETUP
			FDB	S_LOAD_SETUP
			FDB	S_DELAY_TIME
			FDB	S_PITCH_SHIFT
			FDB	S_FEEDBACK
			FDB	S_LEVEL
			FDB	S_SELECT
			FDB	S_DIRECTION
			FDB	S_PAN_RANGE
			FDB	S_KEY_ON_NOTE
			FDB	S_OCTAVE
			FDB	S_INIT_OCTAVE
			FDB	S_EDIT_FULL_KBD
			FDB	S_INIT_FULL_KBD

S_MEM_STR		FCC	"Mem Str	?"
			FCB	$00
S_EG_COPY_OP_OP		FCC	"EG Copy OP  OP ?"
			FCB	$00
S_ARE_YOU_SURE		FCC	" Are you sure?"
			FCB	$00
S_ALG			FCC	"ALG"
			FCB	$10
S_FEEDBACK_OP4		FCC	"Feedback(OP4)"
			FCB	$01
S_EDIT_LFO		FCC	" "
			FCB	SO_EDIT_ - PUTSTR_OFFSET
			FCC	"LFO?"
			FCB	$00
S_WAVE			FCC	" Wave "
			FCB	$09
S_SPEED			FCC	" Speed"
			FCB	$01
S_DELAY			FCC	" Delay"
			FCB	$01
S_P_MOD_DEPTH		FCC	"P Mod Depth"
			FCB	$01
S_A_MOD_DEPTH		FCC	"A Mod Depth"
			FCB	$01
S_SYNC			FCC	" Sync"
			FCB	$02
S_SENSITIVITY		FCC	" Sensitivity?"
			FCB	$00
S_P_MOD_SENS		FCC	"P Mod Sens. "
			FCB	$10
S_AMS			FCC	"AMS"
			FCB	$0A
S_EBS			FCC	"EBS"
			FCB	$04
S_KVS			FCC	"KVS"
			FCB	$04
S_EDIT_FREQUENCY	FCB	SO_EDIT_ - PUTSTR_OFFSET
			FCC	"Frequency?"
			FCB	$00
S_FIX_RANGE		FCC	"Fix Range "
			FCB	$12
S_CRS			FCC	"CRS("
			FCB	$03
S_FIN			FCC	"FIN("
			FCB	$03
S_OSW			FCC	"OSW"
			FCB	$04
S_DET			FCC	"DET"
			FCB	$04
S_EDIT_EG		FCB	SO_EDIT_ - PUTSTR_OFFSET
			FCC	"EG?"
			FCB	$00
S_AR			FCC	"AR "
			FCB	$04
S_D1R			FCC	"D1R"
			FCB	$04
S_D1L			FCC	"D1L"
			FCB	$04
S_D2R			FCC	"D2R"
			FCB	$04
S_RR			FCC	"RR "
			FCB	$04
S_SHFT			FCC	"SHFT"
			FCB	$04
S_OUT			FCC	"OUT"
			FCB	$04
S_SCALING		FCC	" Scaling?"
			FCB	$00
S_RS			FCC	"RS "
			FCB	$04
S_LS			FCC	"LS "
			FCB	$04
S_MIDDLE_C		FCC	"Middle C    "
			FCB	$05
S_MASTER_TUNE		FCC	"Master Tune "
			FCB	$06
S_MIDI_CONTROL_		FCC	"Midi Control?"
			FCB	$00
S_CONT_CHANGE		FCC	"Cont.Change"
			FCB	$1C
S_ATOUCH_BC		FCC	"A.Touch ~ BC"
			FCB	$02
S_BASIC_RECV_CH		FCC	"Basic Rcv.Ch"
			FCB	$11
S_TRANSMIT_CH		FCB	SO_TRANSMIT - PUTSTR_OFFSET
			FCC	" Ch"
			FCB	$0B
S_P_CHANGE		FCC	" P.Change "
			FCB	$19
S_PITCHBEND		FCC	" Pitch Bend"
			FCB	$1C
S_NOTE_ON_OFF		FCC	"Note on/off"
			FCB	$0D
S_EXCLUSIVE		FCC	" Exclusive"
			FCB	$02
S_VOICE_TRANS		FCC	"Voice Trans?( )"
			FCB	$0F
S_PERFRM_TRANSMIT	FCC	"Perfrm "
			FCB	SO_TRANSMIT - PUTSTR_OFFSET
			FCC	"?"
			FCB	$00
S_SETUP_TRANS		FCC	"Setup Trans?"
			FCB	$1F
S_INIT_P_CNG_TABLE	FCC	"Init "
			FCB	SO_P_CNG_TBL_ - PUTSTR_OFFSET
			FCB	$00
S_EDIT_P_CNG_TABLE	FCB	SO_EDIT_ - PUTSTR_OFFSET
			FCB	SO_P_CNG_TBL_ - PUTSTR_OFFSET
			FCB	$00
S_CASS_CONTROL_		FCC	"Cass. Control ?"
			FCB	$00
S_RECALL_EDIT_1		FCC	"Recall Edit?"
			FCB	$00
S_INIT_VOICE_1		FCC	"Init Voice?"
			FCB	$00
S_SAVE_32_VOICE		FCC	"Save32Voice?"
			FCB	$0F
S_VERIFY_2		FCC	"Verify "
			FCB	SO_32_VOICE_ - PUTSTR_OFFSET
			FCB	$00
S_LOAD_32_VOICE		FCC	"Load "
			FCB	SO_32_VOICE_ - PUTSTR_OFFSET
			FCB	$00
S_LOAD_1_VOICE		FCC	"Load 1 Voice?"
			FCB	$00
S_SAVE_24_PERFRM	FCC	"Save 24 "
			FCB	SO_PERFRM_ - PUTSTR_OFFSET
			FCB	$00
S_VERIFY_24_PERFRM	FCC	"Verify 24"
			FCB	SO_PERFRM_ - PUTSTR_OFFSET
			FCB	$00
S_LOAD_24_PERFRM	FCC	"Load 24 "
			FCB	SO_PERFRM_ - PUTSTR_OFFSET
			FCB	$00
S_LOAD_1_PERFRM		FCC	"Load 1 "
			FCB	SO_PERFRM_ - PUTSTR_OFFSET
			FCB	$00
S_SAVE_SETUP		FCC	"Save Setup? "
			FCB	$1F
S_VERIFY_SETUP		FCC	"VerifySetup?"
			FCB	$1F
S_LOAD_SETUP		FCC	"Load Setup? "
			FCB	$1F
S_MEM_PROTECT		FCC	"Mem Protect"
			FCB	$02
S_COMBINE		FCC	" Combine  "
			FCB	$02
S_EDIT_EFFECT_1_	FCB	SO_EDIT_ - PUTSTR_OFFSET
			FCB	SO_EFFECT_ - PUTSTR_OFFSET
			FCC	" 1 ?"
			FCB	$00
S_DELAY_TIME		FCC	"Delay Time"
			FCB	$1B
S_PITCH_SHIFT		FCC	"Pitch Shift"
			FCB	$0C
S_LEVEL			FCB	SO_EFFECT_ - PUTSTR_OFFSET
			FCC	"Level "
			FCB	$01
S_FEEDBACK		FCC	" Feedback"
			FCB	$01
S_EDIT_EFFECT_2_	FCB	SO_EDIT_ - PUTSTR_OFFSET
			FCB	SO_EFFECT_ - PUTSTR_OFFSET
			FCC	" 2 ?"
			FCB	$00
S_DIRECTION		FCC	"Direction "
			FCB	$1D
S_SELECT		FCC	"Select "
			FCB	$1D
S_PAN_RANGE		FCC	" Pan Range "
			FCB	$01
S_EDIT_EFFECT_3_	FCB	SO_EDIT_ - PUTSTR_OFFSET
			FCB	SO_EFFECT_ - PUTSTR_OFFSET
			FCC	" 3 ?"
			FCB	$00
S_KEY_ON_NOTE		FCC	"Key on note?"
			FCB	$1E
S_MICRO_TUNE_		FCB	SO_EDIT_ - PUTSTR_OFFSET
			FCC	"Micro Tune?"
			FCB	$00
S_OCTAVE		FCB	SO_EDIT_ - PUTSTR_OFFSET
			FCC	"Octave ?"
			FCB	$00
S_INIT_OCTAVE		FCC	"Init Octave ?"
			FCB	$00
S_EDIT_FULL_KBD		FCB	SO_EDIT_ - PUTSTR_OFFSET
			FCB	SO_FULL_KBD_ - PUTSTR_OFFSET
			FCB	$00
S_INIT_FULL_KBD		FCC	"Init "
			FCB	SO_FULL_KBD_ - PUTSTR_OFFSET
			FCB	$00
S___FUNCTION		FCC	"  Function?"
			FCB	$00
S_CH7			FCB	$07
S_POLY_MODE		FCC	"  Poly"
			FCB	SO__MODE - PUTSTR_OFFSET
			FCB	$00
S_MONO_MODE		FCC	"  Mono"
			FCB	SO__MODE - PUTSTR_OFFSET
			FCB	$00
S_P_BEND_RANGE		FCC	"P Bend Range"
			FCB	$01
S_CH8			FCB	$08
S_FULL_TIME_PORTA	FCC	"Full Time "
			FCB	SO_PORTA - PUTSTR_OFFSET
			FCB	$00
S_FINGERED_PORTA	FCC	"Fingered "
			FCB	SO_PORTA - PUTSTR_OFFSET
			FCB	$00
S_PORTA_TIME		FCB	SO_PORTA - PUTSTR_OFFSET
			FCC	" Time	"
			FCB	$01
S_FC_VOLUME		FCC	"FC Volume   "
			FCB	$01
S_FC_PITCH		FCC	"FC "
			FCB	SO_PITCH____ - PUTSTR_OFFSET
			FCB	$01
S_FC_AMPLITUDE		FCC	"FC "
			FCB	SO_AMPLITUDE - PUTSTR_OFFSET
			FCB	$01
S_MW_PITCH		FCC	"MW "
			FCB	SO_PITCH____ - PUTSTR_OFFSET
			FCB	$01
S_MW_AMPLITUDE		FCC	"MW "
			FCB	SO_AMPLITUDE - PUTSTR_OFFSET
			FCB	$01
S_BC_PITCH		FCB	SO_BC_ - PUTSTR_OFFSET
			FCB	SO_PITCH____ - PUTSTR_OFFSET
			FCB	$01
S_BC_AMPLITUDE		FCB	SO_BC_ - PUTSTR_OFFSET
			FCB	SO_AMPLITUDE - PUTSTR_OFFSET
			FCB	$01
S_BC_P_BIAS		FCB	SO_BC_ - PUTSTR_OFFSET
			FCC	"P. Bias  "
			FCB	$1A
S_BC_EG_BIAS		FCB	SO_BC_ - PUTSTR_OFFSET
			FCC	"EG Bias  "
			FCB	$01
S_REVERB_RATE		FCC	"Reverb Rate "
			FCB	$18
S_ASSIGN_MODE		FCC	"Assign"
			FCB	SO__MODE - PUTSTR_OFFSET
			FCB	$16
S_VOL			FCC	"VOL"
			FCB	$15
S_EFFECT_SEL		FCB	SO_EFFECT_ - PUTSTR_OFFSET
			FCC	"Sel"
			FCB	$17
S_INIT_PERFRM_		FCC	"Init "
			FCB	SO_PERFRM_ - PUTSTR_OFFSET
			FCB	$00
S_TEST_ENTRY		FCC	"Test entry?"
			FCB	$00

S_SAW_UP		FCC	"saw up"
			FCB	$00
S_SQUARE		FCC	"square"
			FCB	$00
S_TRIANGL		FCC	"triangl"
			FCB	$00
S_S_HOLD		FCC	"S/Hold"
			FCB	$00

S_NOTE_ALL		FCC	"all "
			FCB	$00
S_NOTE_ODD		FCC	"odd "
			FCB	$00
S_NOTE_EVEN		FCC	"even"
			FCB	$00

S_FX_DELAY		FCC	"delay"
			FCB	$00
S_FX_PAN		FCC	"pan"
			FCB	$00
S_FX_CHORD		FCC	"chord"
			FCB	$00

S_PAN_LFO		FCC	"LFO"
			FCB	$00
S_PAN_VELOCITY		FCC	"velocity"
			FCB	$00
S_PAN_NOTE		FCC	"note"
			FCB	$00

S_AL_3			FCC	"(AL)"
			FCB	$00
S_SY_3			FCC	"(SY)"
			FCB	$00
S_PC_3			FCC	"(PC)"
			FCB	$00
S_EF_3			FCC	"(EF)"
			FCB	$00
S_MC_3			FCC	"(MC)"
			FCB	$00

SO_32_VOICE_		FCC	"32 Voice?"
			FCB	$00
SO__MODE		FCC	" Mode"
			FCB	$00
SO_PORTA		FCC	"Porta"
			FCB	$00
SO_BC_			FCC	"BC "
			FCB	$00
SO_AMPLITUDE		FCC	"Amplitude"
			FCB	$00
SO_PITCH____		FCC	"Pitch	  "
			FCB	$00
SO_EDIT_		FCC	"Edit "
			FCB	$00
SO_PERFRM_		FCC	"Perfrm?"
			FCB	$00
SO_TRANSMIT		FCC	"Transmit"
			FCB	$00
SO_P_CNG_TBL_		FCC	"P.Cng Tbl?"
			FCB	$00
SO_EFFECT_		FCC	"Effect "
			FCB	$00
SO_FULL_KBD_		FCC	"Full Kbd ?"
			FCB	$00
SO_EDIT			FCC	"EDIT"
			FCB	$00
SO_VOICE		FCC	"VOICE"
			FCB	$00
SO_EFFECT		FCC	"EFFECT"
			FCB	$00
SO_ERFORMANCE		FCC	"ERFORMANCE"
			FCB	$00

S_ON			FCC	"on"
			FCB	$00
S_OFF			FCC	"off"
			FCB	$00
S__OF			FCC	" of"
			FCB	$00
S__ON			FCC	" on"
			FCB	$00
S__POR			FCC	" Por"
			FCB	$00
S__SUS			FCC	" Sus"
			FCB	$00
S_NORM			FCC	"norm"
			FCB	$00
S_ALTR			FCC	"altr"
			FCB	$00
S_OMN			FCC	"omn"
			FCB	$00
S_VIB			FCC	"vib"
			FCB	$00
S_RATIO			FCC	"RATIO)"
			FCB	$00
S_FIX			FCC	"FIX)"
			FCB	$00
S_NAME			FCC	"Name :"
			FCB	$0E
S_SLASH_SLASH_RIGHT	FCC	"   /	/   /	"
			FCB	CH_RIGHT
			FCB	$13
S_LEFT_SLASH_SLASH	FCB	CH_LEFT
			FCC	"   /	/   /	"
			FCB	$14
S_P_UT			FCC	"P.UT"
			FCB	$00
S__ED			FCC	".ED"
			FCB	$00
S_LAY_SINGLE		FCC	"LAY SINGLE"
			FCB	$00
S_ERFORMANCE_MODE	FCB	SO_ERFORMANCE - PUTSTR_OFFSET
			FCC	" MODE"
			FCB	$00
S_PFM_STORE		FCC	"PFM Store	?"
			FCB	$00
S_UTILITY_MODE		FCC	"UTILITY MODE"
			FCB	$00
S_UTILITY		FCC	"UTILITY"
			FCB	$00
S_MASTER_VOLUME		FCC	"Master Volume"
			FCB	$00
S_1_2_3_4		FCC	"1  2  3  4"
			FCB	$00
S_LFO_EDIT		FCC	"LFO "
			FCB	SO_EDIT - PUTSTR_OFFSET
			FCB	$00
S_SENS_EDIT		FCC	"SENS "
			FCB	SO_EDIT - PUTSTR_OFFSET
			FCB	$00
S_FREQ			FCC	"FREQ."
			FCB	$00
S_FUNCTION		FCC	"FUNCTION"
			FCB	$00
S_UT			FCC	"UT"
			FCB	$00
S_RECALL_EDIT		FCC	"RECALL "
			FCB	SO_EDIT - PUTSTR_OFFSET
			FCB	$00
S_INIT_VOICE		FCC	"INIT "
			FCB	SO_VOICE - PUTSTR_OFFSET
			FCB	$00
S_MIDI_CONTROL		FCC	"MIDI CONTROL"
			FCB	$00
S_CASS_CONTROL		FCC	"CASS CONTROL"
			FCB	$00
S_EDIT_EFFECT_1		FCB	SO_EDIT - PUTSTR_OFFSET
			FCC	" "
			FCB	SO_EFFECT - PUTSTR_OFFSET
			FCC	"1"
			FCB	$00
S_EDIT_EFFECT_2		FCB	SO_EDIT - PUTSTR_OFFSET
			FCC	" "
			FCB	SO_EFFECT - PUTSTR_OFFSET
			FCC	"2"
			FCB	$00
S_EDIT_EFFECT_3		FCB	SO_EDIT - PUTSTR_OFFSET
			FCC	" "
			FCB	SO_EFFECT - PUTSTR_OFFSET
			FCC	"3"
			FCB	$00
S_CHORD			FCC	"Chord"
			FCB	$02
S_MICRO_TUNE		FCC	"MICRO TUNE"
			FCB	$00
S_MICRO___OCT		FCC	"MICRO	 OCT."
			FCB	$00
S_MICRO___FULL		FCC	"MICRO	 FULL"
			FCB	$00
S_INIT_			FCC	"Init?"
			FCB	$03
S_KEY			FCC	"Key"
			FCB	$00
S__PGM			FCC	" PGM"
			FCB	$00
S__EQUALS__		FCC	" = "
			FCB	$00
S_INIT_P_CNG		FCC	"INIT P.CNG"
			FCB	$00
S_ERFORMANCE_EDIT	FCB	SO_ERFORMANCE - PUTSTR_OFFSET
			FCC	" "
			FCB	SO_EDIT - PUTSTR_OFFSET
			FCB	$00
S_VOICE_EDIT_		FCB	SO_VOICE - PUTSTR_OFFSET
			FCC	" "
			FCB	SO_EDIT - PUTSTR_OFFSET
			FCC	"?"
			FCB	$00
S_INIT__		FCC	"INIT  "
			FCB	$00
S_MAX_NOTES		FCC	"MAX NOTES"
			FCB	$00
S_RECEIVE_CH		FCC	"RECEIVE CH"
			FCB	$00
S_LIMIT_L		FCC	"LIMIT/L"
			FCB	$00
S_LIMIT_H		FCC	"LIMIT/H"
			FCB	$00
S_INST_DETUNE		FCC	"INST DETUNE"
			FCB	$00
S_NOTE_SHIFT		FCC	"NOTE SHIFT"
			FCB	$00
S_OUT_ASSIGN		FCC	"OUT ASSIGN"
			FCB	$00
S_LFO_SELECT		FCC	"LFO SELECT"
			FCB	$00
S_MICTUN		FCC	"MICTUN="
			FCB	$01

S_SHARPS		FCC	" CC# DD# E FF# GG# AA# B"
S_FLATS			FCC	" CDb DEb E FGb GAb ABb B"

S_EQUAL			FCC	"Equal"
			FCB	$00
S_PURE_MAJOR		FCC	"Pure(major)"
			FCB	$01
S_PURE_MINOR		FCC	"Pure(minor)"
			FCB	$01
S_MEAN_TONE		FCC	"Mean tone"
			FCB	$01
S_PYTHAGOREAN		FCC	"Pythagorean"
			FCB	$01
S_WERCKMEISTER		FCC	"Werckmeister"
			FCB	$00
S_KIRNBERGER		FCC	"Kirnberger"
			FCB	$00
S_VALLOTTI_YOUNG		FCC	"Vallotti&young"
			FCB	$00
S_1_4_SHIFT_EQUAL	FCC	"1/4 Shift eql"
			FCB	$00
S_1_4_TONE		FCC	"1/4 Tone"
			FCB	$00
S_1_8_TONE		FCC	"1/8 Tone"
			FCB	$00

S_PFM_SINGLE		FCC	"singl"
			FCB	$00
S_PFM_DUAL		FCC	"dual"
			FCB	$00
S_PFM_SPLIT		FCC	"split"
			FCB	$00
S_PFM_MONO8		FCC	"mono8"
			FCB	$00
S_PFM_POLY4		FCC	"poly4"
			FCB	$00

;-------

F_AF7D			LDAB	M7772
			ANDB	#$04
			BEQ	F_AF91
			CMPA	#$18
			BCS	1F
			CLRA
1			LDAB	#'F'
			JSR	PUTCHAR
			INCA
			BRA	C_AFAA

;-------

F_AF91			CMPA	#$A0
			BCS	1F
			CLRA
1			LDAB	#$49
			SUBA	#$20
			BMI	3F
			LDAB	#'A'
2			SUBA	#$20
			BMI	3F
			INCB
			BRA	2B
3			JSR	PUTCHAR
			ADDA	#$21
C_AFAA			LDAB	#$01
			JSR	PUT_DIGIT_2
			RTS

;-------

F_AFB0			LDAB	#'E'
			JSR	F_9CBF
			JSR	PUTCHAR
			LDX	#M776E
1			LDAA	,X
			ANDA	#$01
			JSR	PUT_DIGIT_1
			INX
			CPX	#M7772
			BNE	1B
			RTS

;-------

F_AFC9			LDX	#M6E3B
1			LDAB	,X
			JSR	PUTCHAR
			INX
			CPX	#USER_PFM
			BNE	1B
			RTS

;-------

F_AFD8			JSR	F_B53E
			LDAB	#$4D

;-------	fallthrough

F_AFDD			ABX
			CLRB
1			PSHB
			LDAB	,X
			JSR	PUTCHAR
			INX
			PULB
			INCB
			CMPB	#$0A
			BNE	1B
			RTS

;-------

F_AFED			TST	M7788
			BNE	5F
			LDAB	M7774
			BNE	2F
1			JMP	13F
2			CMPB	#$05
			BEQ	1B
			CMPB	#$06
			BEQ	3F
			CMPB	#$08
			BNE	4F
3			LDX	#LCD_BUFFER + 6
			STX	M00A7
			LDX	#S_1_2_3_4
			JSR	PUTSTRX
			BRA	13F
4			LDX	#LCD_BUFFER + 7
			STX	M00A7
			LDX	#S_ALG
			JSR	PUTSTRX
			JSR	F_B53E
			LDAA	$34,X
			INCA
			JSR	PUT_DIGIT_1
			BRA	13F
5			LDX	#LCD_BUFFER + 6
			STX	M00A7

			LDAB	M7774
			JSR	JMPOFF1
			FCB	13F - *
			FCB	$02
			FCB	C_B048 - *
			FCB	$03
			FCB	C_B04D - *
			FCB	$04
			FCB	C_B052 - *
			FCB	$05
			FCB	13F - *
			FCB	$07
			FCB	C_B057 - *
			FCB	$08
			FCB	13F - *
			FCB	$09
			FCB	C_B057 - *
			FCB	$0A
			FCB	C_B05C - *
			FCB	$0B
			FCB	13F - *
			FCB	$00

C_B048			LDX	#S_LFO_EDIT
			BRA	12F
C_B04D			LDX	#S_SENS_EDIT
			BRA	12F
C_B052			LDX	#S_FREQ
			BRA	11F
C_B057			LDX	#S_1_2_3_4
			BRA	12F
C_B05C			LDX	#S_FUNCTION
			BRA	12F
11			JSR	PUTSTRX
			LDX	#$4F50
			STX	LCD_BUFFER + 13
			LDAA	M777B
			ANDA	#$03
			ADDA	#$31
			STAA	LCD_BUFFER + 15
			BRA	13F
12			JSR	PUTSTRX
13			RTS

;-------

F_B07A			TST	M7788
			BNE	4F
			TST	>M00A5
			BEQ	2F
			LDX	#S_UT
			JSR	PUTSTRX
			LDX	#LCD_BUFFER + 4
			STX	M00A7
			LDAB	M7774
			CMPB	#$1D
			BEQ	1F
			CMPB	#$1E
			BNE	2F
			LDX	#S_RECALL_EDIT
			BRA	3F
1			LDX	#S_INIT_VOICE
			BRA	3F
2			LDX	#S_UTILITY_MODE
3			JSR	PUTSTRX
			BRA	13F
4			LDX	#S_UT
			JSR	PUTSTRX
			LDX	#LCD_BUFFER + 4
			STX	M00A7
			LDAB	M7788
			CMPB	#$02
			BCC	14F

			LDAB	M7774
			JSR	JMPOFF1
			FCB	13F - *
			FCB	$15
			FCB	C_B0D0 - *
			FCB	$16
			FCB	13F - *
			FCB	$18
			FCB	C_B0DC - *
			FCB	$19
			FCB	C_B0E0 - *
			FCB	$1D
			FCB	13F - *
			FCB	$00

C_B0D0			TST	>M00A5
			BEQ	6F
			LDAB	#$0A
			BRA	9F
6			CLRB
			BRA	9F

C_B0DC			LDAB	#$01
			BRA	9F

C_B0E0			SUBB	#$17
9			LDX	#DVEC_B14D
C_B0E5			ASLB
			ABX
			LDX	,X
			JSR	PUTSTRX
			CMPB	#$01
			BEQ	12F
			CMPB	#$02
			BEQ	11F
			CMPB	#$03
			BNE	13F
			LDAA	M778A
			CMPA	#$01
			BCS	13F
			CMPA	#$05
			BCC	13F
			LDX	#LCD_BUFFER + 13
			STX	M00A7
			LDX	#S_KEY
			JSR	PUTSTRX
			BRA	13F
11			LDX	#LCD_BUFFER + 13
			STX	M00A7
			LDAB	M7789
			ADDB	#$3C
			JSR	F_B43F
			BRA	13F
12			JSR	F_B47B
13			RTS
14			LDAB	M7774
			CMPB	#$1B
			BNE	15F
			LDAB	#$06
			BRA	9B
15			CMPB	#$1C
			BEQ	16F
			CMPB	#$15
			BNE	13B
			BRA	C_B0D0
16			LDAB	M7789
			ANDB	#$01
			BNE	18F
			LDAB	#$07
			TST	M7789
			BEQ	17F
			INCB
17			BRA	9B
18			LDAB	#$09
			BRA	9B

DVEC_B14D		FDB     S_MIDI_CONTROL
			FDB     S_CASS_CONTROL
			FDB     S_EDIT_EFFECT_1
			FDB     S_EDIT_EFFECT_2
			FDB     S_EDIT_EFFECT_3
			FDB     S_MICRO_TUNE
			FDB     S_CHORD
			FDB     S_MICRO___OCT
			FDB     S_MICRO___FULL
			FDB     S_INIT_
			FDB     S_INIT_P_CNG

;-------

F_B163			LDAB	#'P'
			JSR	F_9CD0
			JSR	PUTCHAR
			LDX	#S__ED
			JSR	PUTSTRX

			LDAB	M7774
			JSR	JMPOFF1
			FCB	9F - *
			FCB	$28
			FCB	C_B189 - *
			FCB	$29
			FCB	C_B18F - *
			FCB	$2A
			FCB	C_B1A4 - *
			FCB	$2B
			FCB	C_B193 - *
			FCB	$30
			FCB	9F - *
			FCB	$31
			FCB	C_B197 - *
			FCB	$34
			FCB	C_B189 - *
			FCB	$36
			FCB	9F - *
			FCB	$00

C_B189			CLRB
			LDX	#LCD_BUFFER + 1
			BRA	6F

C_B18F			LDAB	#$01
			BRA	5F

C_B193			SUBB	#$29
			BRA	5F

C_B197			SUBB	#$2A
5			LDX	#LCD_BUFFER + 5
6			STX	M00A7
			LDX	#DVEC_B1BA
			JMP	C_B0E5

C_B1A4			LDX	#LCD_BUFFER + 5
			STX	M00A7
			LDAA	M778C
			CMPA	#$08
			BCS	8F
			CLRA
8			JSR	F_B4E2
			LDAB	#$4D
			JSR	F_AFDD
9			RTS

DVEC_B1BA		FDB     S_ERFORMANCE_EDIT
			FDB     S_MAX_NOTES
			FDB     S_RECEIVE_CH
			FDB     S_LIMIT_L
			FDB     S_LIMIT_H
			FDB     S_INST_DETUNE
			FDB     S_NOTE_SHIFT
			FDB     S_OUT_ASSIGN
			FDB     S_LFO_SELECT
			FDB     S_MICTUN

;-------

F_B1CE			LDX	#S_P_UT
			JSR	PUTSTRX
			LDX	#LCD_BUFFER + 5
			STX	M00A7
			LDAB	M7774
			CMPB	#$3C
			BNE	1F
			LDX	#S_VOICE_EDIT_
			BRA	4F
1			CMPB	#$3D
			BNE	5F
			TST	>M00A5
			BEQ	3F
			LDX	#S_INIT__
			JSR	PUTSTRX
2			LDAB	M777E
			ASLB
			LDX	#DVEC_STD_PFM_NAMES
			ABX
			LDX	,X
			BRA	4F
3			LDX	#LCD_BUFFER + 2
			STX	M00A7
			LDX	#S_UTILITY
			JSR	PUTSTRX
			LDX	#LCD_BUFFER + 11
			STX	M00A7
			BRA	2B
4			JSR	PUTSTRX
			BRA	6F
5			LDX	#LCD_BUFFER + 2
			STX	M00A7
			LDX	#S_UTILITY
			BRA	4B
6			RTS

DVEC_STD_PFM_NAMES	FDB	S_PFM_SINGLE
			FDB	S_PFM_DUAL
			FDB	S_PFM_SPLIT
			FDB	S_PFM_MONO8
			FDB	S_PFM_POLY4

;-------

F_B22C			PSHA
			LDAB	#$40
			LDX	#CG_B2E0
1			JSR	SET_CGCHAR
			CMPB	#$50
			BNE	1B
			PULB
			CMPB	#$08
			BCS	2F
			CLRB
2			JSR	JMPOFFB
			FCB	C_B24A - *
			FCB	C_B258 - *
			FCB	C_B26B - *
			FCB	C_B27E - *
			FCB	C_B299 - *
			FCB	C_B2A6 - *
			FCB	C_B2BC - *
			FCB	C_B2C4 - *

C_B24A			LDX	#LCD_BUFFER + 22
			STX	M00A7
			LDX	#S_ALG_1
			JSR	PUTSTRX
			JMP	14F

C_B258			LDD	#$3300
			STD	LCD_BUFFER + 8
			LDX	#LCD_BUFFER + 24
			STX	M00A7
			LDX	#S_ALG_2
			JSR	PUTSTRX
			BRA	14F

C_B26B			LDD	#$3400
			STD	LCD_BUFFER + 10
			LDX	#LCD_BUFFER + 24
			STX	M00A7
			LDX	#S_ALG_3
			JSR	PUTSTRX
			BRA	14F

C_B27E			LDX	#LCD_BUFFER + 8
			STX	M00A7
			LDX	#S_ALG_4
			JSR	PUTSTRX
			CLR	LCD_BUFFER + 11
8			LDX	#LCD_BUFFER + 26
			STX	M00A7
			LDX	#S_ALG_5
			JSR	PUTSTRX
			BRA	14F

C_B299			LDX	#LCD_BUFFER + 10
			STX	M00A7
			LDX	#S_ALG_6
			JSR	PUTSTRX
			BRA	8B

C_B2A6			LDD	#$0134
			STD	LCD_BUFFER + 9
			CLR	LCD_BUFFER + 11
11			LDX	#LCD_BUFFER + 24
			STX	M00A7
			LDX	#S_ALG_7
			JSR	PUTSTRX
			BRA	14F

C_B2BC			LDD	#$0134
			STD	LCD_BUFFER + 13
			BRA	11B

C_B2C4			LDX	#LCD_BUFFER + 8
			STX	M00A7
			LDX	#S_ALG_7
			JSR	PUTSTRX
			LDAB	#$34
			STAB	LCD_BUFFER + 14
			LDX	#LCD_BUFFER + 24
			STX	M00A7
			LDX	#S_PLUS_MINUS
			JSR	PUTSTRX
14			RTS

; CGCHAR
CG_B2E0			FCB	%00000000
			FCB	%00000000
			FCB	%00010000
			FCB	%00001001
			FCB	%00000101
			FCB	%00000001
			FCB	%00001111
			FCB	%00000000
; CGCHAR
			FCB	%00000000
			FCB	%00000000
			FCB	%00000001
			FCB	%00010010
			FCB	%00010100
			FCB	%00010000
			FCB	%00011110
			FCB	%00000000

S_ALG_1			FCC	"4~3~2~1~"
			FCB	$00
S_ALG_2			FCC	"4~2~1~"
			FCB	$00
S_ALG_3			FCC	"3~2~1~"
			FCB	$00
S_ALG_4			FCC	"4~3"
			FCB	$00
S_ALG_5			FCC	"2~1~"
			FCB	$00
S_ALG_6			FCC	"4~3~"
			FCB	$00
S_ALG_7			FCC	"1 2 3"
			FCB	$00
S_PLUS_MINUS		FCC	"+-+-+-+"
			FCB	$00

;-------

SET_CGCHAR_SET		LDAB	#$40
			LDX	#D_CGCHAR_SET
1			BSR	SET_CGCHAR
			CMPB	#$80
			BNE	1B
			RTS

SET_CGCHAR		CLRA
1			PSHA
			LDAA	,X
			JSR	LCD_DO_CMD_DATA
			INX
			INCB
			PULA
			INCA
			CMPA	#$08
			BNE	1B
			RTS

D_CGCHAR_SET
; CGCHAR 0
			FCB	%00000100
			FCB	%00001010
			FCB	%00010001
			FCB	%00010000
			FCB	%00000000
			FCB	%00000000
			FCB	%00000000
			FCB	%00000000
; CGCHAR 1
			FCB	%00000000
			FCB	%00000000
			FCB	%00000000
			FCB	%00000001
			FCB	%00010001
			FCB	%00001010
			FCB	%00000100
			FCB	%00000000

; CGCHAR 2
			FCB	%00000100
			FCB	%00000100
			FCB	%00001010
			FCB	%00010001
			FCB	%00000000
			FCB	%00000000
			FCB	%00000000
			FCB	%00000000
; CGCHAR 3
			FCB	%00000000
			FCB	%00000000
			FCB	%00000000
			FCB	%00010001
			FCB	%00001010
			FCB	%00000100
			FCB	%00000100
			FCB	%00000000
; CGCHAR 4
			FCB	%00001000
			FCB	%00010100
			FCB	%00010100
			FCB	%00010101
			FCB	%00000101
			FCB	%00000101
			FCB	%00000010
			FCB	%00000000
; CGCHAR 5
			FCB	%00001000
			FCB	%00001000
			FCB	%00010100
			FCB	%00010101
			FCB	%00000101
			FCB	%00000010
			FCB	%00000010
			FCB	%00000000
; CGCHAR 6
			FCB	%00001010
			FCB	%00010101
			FCB	%00010101
			FCB	%00010101
			FCB	%00000000
			FCB	%00000000
			FCB	%00000000
			FCB	%00000000
; CGCHAR 7
			FCB	%00001010
			FCB	%00001010
			FCB	%00010101
			FCB	%00010101
			FCB	%00000000
			FCB	%00000000
			FCB	%00000000
			FCB	%00000000

F_B37F			LDX	#CG_B386
			LDAB	#$40
			BRA	SET_CGCHAR

; CGCHAR 0
CG_B386			FCB	%00011111
			FCB	%00001010
			FCB	%00001010
			FCB	%00001010
			FCB	%00001010
			FCB	%00001010
			FCB	%00011111
			FCB	%00000000

F_B38E			LDX	#CG_B398
			LDAB	#$40
			BSR	SET_CGCHAR
			JMP	SET_CGCHAR

CG_B398			FCB	%00000010
			FCB	%00000101
			FCB	%00000001
			FCB	%00011001
			FCB	%00000010
			FCB	%00000100
			FCB	%00000111
			FCB	%00000000

			FCB	%00000010
			FCB	%00000110
			FCB	%00000010
			FCB	%00011010
			FCB	%00000010
			FCB	%00000010
			FCB	%00000111
			FCB	%00000000

;-------
;
; B -> Command, A -> Data
;
LCD_DO_CMD_DATA 	JSR	LCD_WAIT
			STAB	LCD_CMD
			JSR	LCD_WAIT
			STAA	LCD_DATA
			RTS

;-------

F_B3B5			TST	>M00A3
			BNE	1F
			JSR	F_B3E9
1			LDAA	M776D
			COMA
			LSRA
			JSR	F_B4DA
			CLRB
2			SUBA	#$05
			BMI	3F
			INCB
			BRA	2B
3			ADDA	#$05
			PSHA
			LDX	#LCD_BUFFER + 16
			STX	M00A7
			TBA
			BEQ	5F
			LDAB	#$04
4			JSR	PUTCHAR
			DECA
			BNE	4B
5			PULB
			TSTB
			BEQ	6F
			DECB
			JSR	PUTCHAR
6			RTS

;-------

F_B3E9			LDAB	#$40
			LDAA	#$20
1			PSHB
			ANDB	#$07
			BNE	2F
			LSRA
			ORAA	#$10
2			CMPB	#$07
			PULB
			BNE	3F
			PSHA
			CLRA
			BRA	4F
3			PSHA
4			BSR	LCD_DO_CMD_DATA
			PULA
			INCB
			CMPB	#$68
			BNE	1B
			RTS

;-------

F_B408			LDAB	#$40
1			PSHB
			COMB
			ANDB	#$38
			LSRB
			LSRB
			LSRB
			DECB
			STAB	M00AB
			PULB
			CLRA
2			PSHA
			CMPA	#$07
			BEQ	3F
			CMPA	M00AB
			BCC	4F
3			CLRA
			BRA	5F
4			LDAA	#$1F
5			BSR	LCD_DO_CMD_DATA
			INCB
			PULA
			INCA
			CMPA	#$08
			BNE	2B
			CMPB	#$78
			BNE	1B
			RTS

;-------

F_B432			LDX	#S_ON
			TSTA
			BNE	1F
			LDX	#S_OFF
1			JSR	PUTSTRX
			RTS

;-------

F_B43F			PSHB
			JSR	F_B38E
			PULB
			LDX	M00A7
			LDAA	#$2D
1			INCA
			SUBB	#$0C
			BCC	1B
			CMPA	#$30
			BCC	2F
			SUBA	#$2E
2			STAA	$02,X
			ADDB	#$0C
			ASLB
			PSHX
			LDX	#S_SHARPS
			ABX
			LDD	,X
			PULX
			STD	,X
			RTS

;-------

F_B463			SUBA	#$40

;-------	fallthrough

F_B465			BHI	1F
			BMI	2F
			LDAB	#$20
			BRA	3F
1			LDAB	#$2B
			BRA	3F
2			NEGA
			LDAB	#'-'
3			JSR	PUTCHAR
			CLRB
			JMP	PUT_DIGIT_2

;-------

F_B47B			LDAA	M6E37
			BNE	1F
			LDX	#S_OCT
			BRA	2F
1			CMPA	#$02
			BCC	3F
			LDX	#S_FULL
2			JSR	PUTSTRX
			BRA	8F
3			DECA
			CMPA	#$0A
			BCC	7F
			PSHA
			JSR	PUT_DIGIT_1
			PULA
			CMPA	#$02
			BCS	8F
			CMPA	#$06
			BCC	8F
			LDAB	M6E3A
			LDAA	M6E37
			CMPA	#$04
			BNE	5F
			ADDB	#$09
			CMPB	#$0C
			BCS	4F
			SUBB	#$0C
4			ASLB
			LDX	#S_SHARPS
			BRA	6F
5			ASLB
			LDX	#S_FLATS
6			ABX
			LDD	,X
			STD	LCD_BUFFER + 14
			BRA	8F
7			CLRB
			JSR	PUT_DIGIT_2
8			RTS

S_OCT			FCC	"Oct."
			FCB	$00
S_FULL			FCC	"Full"
			FCB	$00

;-------

F_B4D6			LDAB	#200
			MUL
			RTS

;-------

F_B4DA			LDAB	#142
			MUL
			RTS

;-------

F_B4DE			LDAB	#38
			MUL
			RTS

;-------

F_B4E2			LDAB	#$6E
			MUL
			ADDD	#M6A67
			XGDX
			RTS

D_B4EA			FCB	$00,$01,$02,$03,$04,$05,$06,$07
			FCB	$08,$09,$0C,$0A,$0B,$10,$0D,$0E
			FCB	$14,$0F,$11,$18,$12,$13,$1C,$15
			FCB	$16,$20,$19,$17,$24,$1A,$1D,$28
			FCB	$1B,$1E,$2C,$21,$30,$1F,$22,$25
			FCB	$34,$23,$38,$29,$26,$3C,$2D,$27
			FCB	$2A,$31,$2E,$2B,$35,$32,$2F,$39
			FCB	$36,$33,$3D,$3A,$37,$3E,$3B,$3F

D_B52A			FCB	$03,$01,$02,$00

;-------

F_B52E			LDAB	M777B
			LDAA	#$0D

;-------	fallthrough

F_B533			LDX	#D_B52A
			ABX
			LDAB	,X
			MUL
			BSR	F_B53E
			ABX
			RTS

;-------

F_B53E			XGDX
			LDAB	M778B
			LDAA	#$6E
			MUL
			ADDD	#M6A67
			XGDX
			RTS

;-------

			INCLUDE	"inc/jmpoff.asm"

0	 		BRA	0B

			ORG	$D1C0

			INCLUDE	"inc/voice.asm"
			INCLUDE	"inc/pfm.asm"
			INCLUDE	"inc/vecs.asm"
